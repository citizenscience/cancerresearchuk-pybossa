<!-- Trailblazer pathology image processor script-->
<!-- Copyright (C) 2016 Cancer Research UK-->

<!-- This file is part of Trailblazer - Cancer Research UK's citizen science project for immunohistochemistry (IHC) scoring.-->

<!-- Trailblazer is free software: you can redistribute it and/or modify-->
<!-- it under the terms of the GNU Affero General Public License as-->
<!-- published by the Free Software Foundation, either version 3 of the-->
<!-- License, or (at your option) any later version.-->

<!-- This program is distributed in the hope that it will be useful,-->
<!-- but WITHOUT ANY WARRANTY; without even the implied warranty of-->
<!-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the-->
<!-- GNU Affero General Public License for more details.-->

<!-- You should have received a copy of the GNU Affero General Public License-->
<!-- along with this program.  If not, see <http://www.gnu.org/licenses/>.-->
<script src="/static/trailblazer/js/jquery.elevateZoom.min.js" type="text/javascript"></script>
<script src="/static/trailblazer/js/raphael-min.js" type="text/javascript"></script>
<script src="/static/trailblazer/js/device.js" type="text/javascript"></script>
<script src="/static/trailblazer/js/nouislider.min.js" type="text/javascript"></script>

<script src="/static/trailblazer/js/imagesloaded.js" type="text/javascript"></script>
<script src="/static/trailblazer/js/jquery.cookie.js" type="text/javascript"></script>
<script src="/static/trailblazer/js/jquery.elevateZoom.min.js" type="text/javascript"></script>
<script src="/static/trailblazer/js/jquery.textchange.min.js" type="text/javascript"></script>
<script src="/static/trailblazer/js/respond.js" type="text/javascript"></script>
<script src="/static/trailblazer/js/slick.js" type="text/javascript"></script>

<link rel="stylesheet" href="/static/trailblazer/css/nouislider.css" />
<link rel="stylesheet" href="/static/trailblazer/css/slick-theme.css" />
<link rel="stylesheet" href="/static/trailblazer/css/slick.css" />
<link rel="stylesheet" href="/static/trailblazer/css/trailblazer.css" />

<div class="wrappy">
    <div class="device-message">
        <div class="casper"></div>
        <div class="device-message-inner">
            <h1>Please view on a desktop computer</h1>

            <h3>We are currently working on development for other devices.</h3>
        </div>
    </div>
</div>
<!--MODAL-->
<div class="modals row">
    <div class="span12">
        <div id="skipSlideModal" class="modal hide">
            <div class="modal-body skipModalFirst">
                <div class="modal-image">
                    <img class="skipSlideImage"/>
                </div>
                <div class="modal-info">
                    <h1>
                        Please tell us why you would like to skip this image
                    </h1>
                    <form class="skipReason">
                        <div class="skipReason-choice">
                            <input class="reasonButton" type="radio" name="skipReason" value="blank-image">
                            <span>There is nothing in this image</span>
                        </div>
                        <div class="skipReason-choice">
                            <input class="reasonButton" type="radio" name="skipReason" value="poor-quality-image">
                            <span>There is something wrong with the image (e.g. poor quality)</span>
                        </div>
                        <div class="skipReason-choice">
                            <input class="needsNextButton reasonButton" type="radio" name="skipReason"
                                value="image-too-difficult"> <span>This image is too difficult to analyse</span>
                        </div>
                    </form>

                </div>
            </div>
            <div class="modal-body skipModalLast" style="display: none;">
                <div class="modal-image">
                    <img class="skipSlideImage"/>
                </div>
                <div class="modal-info">
                    <h1>
                        Even experts find this difficult sometimes
                    </h1>
                    <h2>
                        We combine your response with many others’ so small mistakes can get cancelled out.
                    </h2>
                    <h2>
                        Your best guess is often good enough for us.
                    </h2>
                    <h2>
                        Only analysing the sections you are more certain about is still incredibly useful.
                    </h2>
                    <h2>
                        Why not give it another try?
                    </h2>
                </div>
            </div>
            <div class="modal-footer">
                <button id="changeMind" type="button" class="btn btn-primary" data-dismiss="modal">I'll try again
                </button>
                <a id="iWantToSkip-first" href="#" class="btn btn-success iWantToSkip" data-dismiss="modal">I want to
                    skip</a>
                <a id="iWantToSkip-last" href="#" class="btn btn-success" style="display: none;">I want to skip</a>
            </div>
        </div>
        <!-- Practice/Feedback Modal -->
        <div id="feedbackTutorialOne" class="modal hide">
            <!-- New feedback content -->
            <div id="0" class="modal-body feedTutOne" style="display:none">
                <div class="modal-image">
                    <img
                        src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-various-stained-images.jpg"/>
                </div>
                <div class="modal-info">
                    <h1>
                        Well done, let’s move on
                    </h1>
                    <h2>
                        Some cancer cells have had their outlines, known as membranes, stained dark brown.
                    </h2>
                    <h2>
                        Other cancer cells have not taken on any brown staining around their outline, or membrane.
                    </h2>
                </div>
            </div>

            <div id="1" class="modal-body feedTutOne" style="display:none">
                <div class="modal-image">
                    <img src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-various-stained-images.jpg"/>
                </div>
                <div class="modal-info">
                    <h1>
                        We have two questions
                    </h1>
                    <h2>
                        Can you estimate the proportion of <strong class="text-error">cancer cells</strong> that are
                        stained?
                    </h2>
                    <h2>
                        We also want to know how intensely stained <strong>most</strong> of the stained cancer cells
                        are.
                    </h2>
                </div>
            </div>

            <div id="2" class="modal-body feedTutOne" style="display:none">
                <div class="modal-image">
                    <img src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-various-stained-images.jpg"/>
                </div>
                <div class="modal-info">
                    <h1>
                        We need to know whether membranes are <strong>fully</strong>, <strong>partially</strong> or
                        <strong>faintly</strong> stained.
                    </h1>
                    <ul>
                        <li><strong>Fully</strong> – Even without zooming in, you can see dark brown lines that go all
                            the way around the cell. In clumps this can look like chicken wire.
                        </li>
                        <li><strong>Partially</strong> – You can see dark brown lines around the cancer cells but when
                            zoomed in, you see they do not go all the way around the cells.
                        </li>
                        <li><strong>Faintly</strong> – You can see brown lines around the cells but they are only clear
                            when you are zoomed in.
                        </li>
                    </ul>
                    <h3>Let’s try with some real images.</h3>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" style="display: none; margin-left: 10px;"
                    class="btn btn-success pull-right feedbackContinue" data-dismiss="modal" aria-hidden="true">
                    Continue
                </button>
                <a id="feedbackPrevBtn" href="#" class="btn" style="display: none;">Previous</a>
                <a id="feedbackNextBtn" href="#" class="btn btn-success">Next</a>
            </div>
        </div>

        <div id="feedbackTutorialTwo" class="modal hide">
            <!-- New feedback content -->
            <div id="0" class="modal-body feedTutTwo" style="display:none">
                <div class="modal-image">
                    <img src="/static/trailblazer/images/lung_egfr/tutorial/grid-red.jpg "/>
                </div>
                <div class="modal-info">
                    <h1>From now on <b>you only need to click on the sections that contain cancer</b>.</h1>
                    <h2>Non-cancer sections can be left blank.</h2>
                    <!--<h2>This may take you up to a minute.</h2>-->
                    <h2>Use the reference images at the bottom to help.</h2>
                </div>
            </div>

            <div id="1" class="modal-body feedTutTwo" style="display:none">
                <div class="modal-image">
                    <img src="/static/trailblazer/images/lung_egfr/tutorial/grid-red.jpg "/>
                </div>
                <div class="modal-info">
                    <h1>What if there are no cancer cells?</h1>
                    <h2>We’ve got a button for that!</h2>
                    <h2>Just click the “No Cancer” button and you’ll move on to the next image.</h2>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" style="display: none; margin-left: 10px; display: none;"
                    class="btn btn-success pull-right feedbackContinueTwo" data-dismiss="modal" aria-hidden="true">
                    Continue
                </button>
                <a id="feedbackPrevBtnTwo" href="#" class="btn" style="display: none;">Previous</a>
                <a id="feedbackNextBtnTwo" href="#" class="btn btn-success">Next</a>
            </div>
        </div>

        <div id="practiseModal" class="modal hide">
            <div id="0" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage"
                        src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-18-cancer-area.jpg"
                        data-zoom-image="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-18-cancer-outline.jpg"
                        alt=""/>
                </div>
                <div id="annotatedImageZoomArea0" class="modal-info">
                    <h2>These <strong class="text-error">cancer cells</strong> have dark brown stained edges.</h2>
                    <h3>We’ve outlined them in <strong class="text-error">red</strong>.</h3>
                    <ul>
                        <li>They’re mostly <b>large</b></li>
                        <li>The shape and size of each cell is very <b>different</b> from the others</li>
                        <li>They’ve formed <b>uneven, lumpy rings</b> and <b>chains</b></li>
                    </ul>
                    <hr>
                    <h2>
                        Everything else is <strong class="text-success">non-cancer cells</strong>
                    </h2>
                    <h3>They include:</h3>
                    <ul>
                        <li><b>Longer</b> and <b>thinner</b> blue stromal cells</li>
                        <li><b>Small blue or dark brown round</b> cells, which are blood cells</li>
                    </ul>
                    <h3>Hover your mouse over the image to take a closer look.</h3>
                </div>
            </div>

            <div id="1" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage"
                        src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-24-cancer-area.jpg"
                        data-zoom-image="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-24-cancer-outline.jpg"
                        alt=""/>
                </div>
                <div id="annotatedImageZoomArea1" class="modal-info">
                    <h2>The <strong class="text-error">cancer cells</strong> are in large clumps in this image.</h2>
                    <h3>We’ve outlined them in <strong class="text-error">red</strong>.</h3>
                    <ul>
                        <li>They are <b>mottled</b> and in <b>different sizes</b></li>
                        <li>There is a complete lack of organisation</li>
                        <li>No two <strong class="text-error">cancer cells</strong> look the same</li>
                    </ul>
                    <hr>
                    <h3>They are surrounded by <strong class="text-success">non-cancer cells</strong>, which include:
                    </h3>
                    <ul>
                        <li><b>Small, dark</b> and <b>round</b> blood cells</li>
                        <li>Mixed with <b>light blue</b> and <b>wispy</b> stromal cells</li>
                    </ul>
                    <h3>Hover your mouse over the image to take a closer look.</h3>
                </div>
            </div>

            <div id="2" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage"
                        src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-22-cancer-area.jpg"
                        data-zoom-image="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-22-cancer-outline.jpg"
                        alt=""/>
                </div>
                <div id="annotatedImageZoomArea2" class="modal-info">
                    <h2>The area containing <b class="text-error">cancer cells</b> has been outlined in red. They form
                        loose rings and clumps of mottled, oval shaped cells of different sizes</h2>
                    <h3>They are <b>large</b>, <b>mottled</b> and <b>irregular</b></h3>
                    <h3>They are surrounded by <b class="text-success">non-cancer</b> cells including:</h3>
                    <h3>They include:</h3>
                    <ul>
                        <li><b>Long</b> and <b>thin</b> blue stromal cells</li>
                        <li><b>Small, dark and round</b> blood cells</li>
                    </ul>
                    <h3>Hover your mouse over the image to take a closer look.</h3>
                </div>
            </div>

            <div id="3" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage"
                        src="/static/trailblazer/images/lung_egfr/EGFR-03.jpg"
                        data-zoom-image="/static/trailblazer/images/lung_egfr/EGFR-03.jpg"
                        alt=""/>
                </div>
                <div id="annotatedImageZoomArea3" class="modal-info">
                    <h2>There are lots of different cell types in this image.</h2>
                    <h2>…but none of them are <b class="text-error">cancer</b>.</h2>
                    <h3>The most common <b class="text-success">non-cancer</b> cells in this image are:</h3>
                    <ul>
                        <li><b>Longer</b> and <b>thinner</b> blue stromal cells</li>
                        <li><b>Small, dark blue, round</b> cells, which are blood cells</li>
                        <li><b>Thin strands</b> of healthy, blue and brown lung cells around the airways (white spaces).
                        </li>
                    </ul>
                </div>
            </div>

            <div id="4" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage"
                        src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-11-cancer-area.jpg"
                        data-zoom-image="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-11-cancer-outline.jpg"
                        alt=""/>
                </div>
                <div id="annotatedImageZoomArea4" class="modal-info">
                    <h2>We’ve outlined the cancer cells in <b class="text-error">red</b>. They’ve formed overcrowded,
                        uneven clumps</h2>
                    <h2>The individual cells all have <b>dark brown</b> edges or membranes</h2>
                    <h3>The other cells are non-cancer cells. They include:</h3>
                    <ul>
                        <li><b>Longer</b> and <b>thinner</b> blue stromal cells</li>
                        <li><b>Small, dark blue and round</b> cells, which are blood cells</li>
                    </ul>
                </div>
            </div>

            <div id="5" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage"
                        src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-25-cancer-area.jpg"
                        data-zoom-image="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-25-cancer-outline.jpg"
                        alt=""/>
                </div>
                <div id="annotatedImageZoomArea5" class="modal-info">
                    <h2>The cancer cells are in <b>small clumps</b></h2>
                    <h2>They are <b>darker than the stromal cells</b> and more <b>mottled, blotchy and bigger than blood
                        cells</b></h2>
                    <h2>Some of the cancer cells have light brown staining on their membranes</h2>
                </div>
            </div>

            <div id="6" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage"
                        src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-26-cancer-area.jpg"
                        data-zoom-image="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-26-cancer-outline.jpg"
                        alt=""/>
                </div>
                <div id="annotatedImageZoomArea6" class="modal-info">
                    <h2>The cancer cells are in clumps again. They are <b>darker than stromal cells</b> and more <b>mottled
                        and bigger than blood cells</b></h2>
                    <h2>Most of them have some brown staining but not always on their membranes</h2>
                    <h2>We are only looking for the brown lines of membrane staining</h2>
                    <h2>Try to ignore the cloudy looking background staining</h2>
                </div>
            </div>

            <!-- STEP 3 INFO -->
            <!--<div id="6" class="modal-body" style="display:none">-->
            <!--<div class="modal-image">-->
            <!--<img src="//citscitools.cancerresearchuk.org/static/trailblazer/images/lung_egfr/tutorial/grid.jpg" />-->
            <!--</div>-->
            <!--<div class="modal-info">-->
            <!--<h1>In the next set of practice images you need to mark the whole image and then we’ll let you know what our experts thought.</h1>-->
            <!--<h2>If you get something wrong look again in detail at that section and try to answer it again.</h2>-->
            <!--</div>-->
            <!--</div>-->

            <!-- SUMMARY -->
            <div id="19" class="modal-body">
                <div class="modal-image">
                    <img src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-05-poor-quality-example.jpg"
                        alt=""/>
                </div>
                <div class="modal-info">
                    <h1>What if you can't analyse an image?</h1>
                    <h2>We have included a <b>“Skip”</b> button in the analysis. Use this and tell us why. It could be
                        because:</h2>
                    <ul>
                        <li>It is completely blank</li>
                        <li>It is a poor quality image</li>
                        <li>It is too difficult to tell the difference between cancer cells and non-cancer cells</li>
                    </ul>
                </div>
            </div>

            <div id="20" class="modal-body">
                <div class="modal-image">
                    <img class="annotatedImage"
                        src="/static/trailblazer/images/lung_egfr/tutorial/mechanic-cancer-yes-no-screenshot.jpg"
                        alt=""/>
                </div>
                <div id="annotatedImageZoomArea6" class="modal-info">
                    <h1>You are now about to <strong>start</strong> analysing cancer images.</h1>
                    <h2>From now on we don't need you to click on the squares. <b>Just let us know if there is cancer in
                        the image or not.</b></h2>
                    <ul>
                        <li>You will be shown 10 images to analyse</li>
                        <li>You can stop and resume later if you want to</li>
                        <li>You can return to the tutorial at any time</li>
                        <li>The reference images at the bottom of the screen scroll to show examples of <strong
                            class="text-error">cancer</strong> and <strong class="text-success">non-cancer
                            cells</strong></li>
                        <li>Don't worry if you're not sure, just give your best guess</li>
                    </ul>
                    <h2>Press Start to begin analysing!</h2>
                </div>
            </div>

            <div id="7" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage"
                        src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-18-cancer-area.jpg"
                        data-zoom-image="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-18-cancer-outline.jpg"
                        alt=""/>
                </div>
                <div id="annotatedImageZoomArea7" class="modal-info">
                    <h2>We’ve outlined the cancer cells in <b class="text-error">red</b></h2>
                    <ul>
                        <li>They’re mostly <b>large</b></li>
                        <li>The shape and size of each cell is very different from the others</li>
                        <li>They’ve formed uneven, overcrowded, lumpy rings and chains</li>
                    </ul>
                    <h2>Everything else is <b class="text-success">non-cancer</b> cells.</h2>
                    <h3>They include:</h3>
                    <ul>
                        <li>Longer and thinner blue stromal cells.</li>
                        <li>Small, dark blue and round cells, which are blood cells.</li>
                    </ul>
                    <h3>Hover your mouse over the image to take a closer look.</h3>
                </div>
            </div>

            <div id="8" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage"
                        src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-24-cancer-area.jpg"
                        data-zoom-image="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-24-cancer-outline.jpg"
                        alt=""/>
                </div>
                <div id="annotatedImageZoomArea8" class="modal-info">
                    <h2>We’ve outlined the cancer cells in <b class="text-error">red</b></h2>
                    <h2>They form jagged, loose rings and clumps of mottled, oval shaped cells of different sizes</h2>
                    <h3>Everything else is <b class="text-success">non-cancer</b> cells.</h3>
                    <h3>They include:</h3>
                    <ul>
                        <li>Longer and thinner blue stromal cells.</li>
                        <li>Small, dark blue and round cells, which are blood cells.</li>
                    </ul>
                    <h3>Hover your mouse over the image to take a closer look.</h3>
                </div>
            </div>

            <div id="9" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage"
                        src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-15-cancer-area.jpg"
                        data-zoom-image="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-15-cancer-outline.jpg"
                        alt=""/>
                </div>
                <div id="annotatedImageZoomArea9" class="modal-info">
                    <h2>We’ve outlined the cancer cells in <b class="text-error">red</b></h2>
                    <h2>They’ve formed mottled and chunky rings with dead cells in the middle</h2>
                    <h3>Everything else is <b class="text-success">non-cancer</b> cells.</h3>
                    <h3>They include:</h3>
                    <ul>
                        <li>Longer and thinner blue stromal cells.</li>
                        <li>Small, dark blue and round cells, which are blood cells.</li>
                    </ul>
                    <h3>Hover your mouse over the image to take a closer look.</h3>
                </div>
            </div>

            <div id="10" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage"
                        src="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-27-cancer-area.jpg"
                        data-zoom-image="/static/trailblazer/images/lung_egfr/tutorial/lung-egfr-gt-27-cancer-outline.jpg"
                        alt=""/>
                </div>
                <div id="annotatedImageZoomArea10" class="modal-info">
                    <h2>We’ve outlined the cancer cells in <b class="text-error">red</b></h2>
                    <ul>
                        <li>They’re mostly <b>large</b></li>
                        <li>The shape and size of each cell is very different from the others</li>
                        <li>They’ve formed uneven, overcrowded, lumpy rings and chains</li>
                    </ul>
                    <h2>Everything else is <b class="text-success">non-cancer</b> cells.</h2>
                    <h3>They include:</h3>
                    <ul>
                        <li>Longer and thinner blue stromal cells.</li>
                        <li>Small, dark blue and round cells, which are blood cells.</li>
                        <li>Colourless or light grey, small cells which are another type of blood cell.</li>
                    </ul>
                    <h3>Hover your mouse over the image to take a closer look.</h3>
                </div>
            </div>

            <div id="11" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage"
                        src="/static/trailblazer/images/lung_egfr/EGFR-07.jpg"
                        data-zoom-image="/static/trailblazer/images/lung_egfr/EGFR-07.jpg"
                        alt=""/>
                </div>
                <div id="annotatedImageZoomArea11" class="modal-info">
                    <h2>There is no cancer in this image</h2>
                    <h2>These are all healthy lung cells. They form thin strands surrounding an airspace (white
                        space)</h2>
                    <h3>If you get a sample with no cancer cells in it, Just press the “No Cancer” Button</h3>
                    <h3>Press Continue and find the No cancer button.</h3>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default pull-right" id="backToPractiseBtn" data-dismiss="modal"
                    aria-hidden="true">Continue
                </button>
                <button class="btn btn-primary" id="startMechanicBtn" data-dismiss="modal" aria-hidden="true"
                    style="display: none;">
                    <i class="icon-thumbs-up"></i> Start
                </button>
                <button class="btn btn-primary" id="startMechanicScreenBtn" style="display: none;">
                    Next
                </button>
            </div>
        </div>

        <!-- Tutoiral Modal -->
        <div id="tutorialModal" class="modal hide ">
            <div id="0" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="/static/trailblazer/images/lung_egfr/min/EGFR-15-min.jpg" alt=""/>
                </div>
                <div class="modal-info">
                    <h1>
                        Welcome to Trailblazer DEMO!
                    </h1>
                    <h2>
                        We need your help identifying <strong class="text-error">lung cancer</strong> cells,
                        distinguishing them from <strong class="text-success">non-cancer cells</strong> in images like
                        the one to the left.
                    </h2>
                    <h2>
                        We’ll give you some examples and a chance to practice first. Click <strong>Next</strong> to
                        begin
                    </h2>
                </div>
            </div>

            <!--<div id="1" class="modal-body" style="display:none">-->
            <!--<div class="modal-image">-->
            <!--<img src="/static/trailblazer/images/lung_egfr/tutorial/village.jpg" alt="" />-->
            <!--</div>-->
            <!--<div class="modal-info">-->
            <!--<h1>-->
            <!--Non-cancer cells are strictly organised and controlled.-->
            <!--</h1>-->
            <!--<h2>-->
            <!--This is similar to the houses in this town. They’ve been carefully planned and built to strict guidelines, taking other houses in the area into consideration. Permission is needed to make any changes to this highly regulated town.-->

            <!--</h2>-->
            <!--</div>-->
            <!--</div>-->

            <!--<div id="2" class="modal-body" style="display:none">-->
            <!--<div class="modal-image">-->
            <!--<img src="/static/trailblazer/images/lung_egfr/tutorial/towns.jpg" alt="" />-->
            <!--</div>-->
            <!--<div class="modal-info">-->
            <!--<h1>-->
            <!--But, in cancer, cells become less tightly controlled.-->
            <!--</h1>-->
            <!--<h2>-->
            <!--When cells become cancerous, they become less controlled. They replicate to make more cells wherever and however they can, with little consideration to rules or regulations. Our town is rapidly expanding, with buildings of all shapes and sizes sprouting up wherever they find space.-->
            <!--</h2>-->
            <!--</div>-->
            <!--</div>-->

            <!--<div id="3" class="modal-body" style="display:none">-->
            <!--<div class="modal-image">-->
            <!--<img src="/static/trailblazer/images/lung_egfr/tutorial/city.jpg" alt="" />-->
            <!--</div>-->
            <!--<div class="modal-info">-->
            <!--<h1>-->
            <!--In serious cases, cancer becomes a sprawling mass of disorganised cells, of <b>all</b> shapes and sizes.-->
            <!--</h1>-->
            <!--<h2>-->
            <!--Our town has grown into a crowded and varied city. With continued growth and lack of control, it starts to spread and take over neighbouring areas.-->
            <!--</h2>-->
            <!--</div>-->
            <!--</div>-->


            <!--WITH CAROUSEL-->
            <div id="1" class="modal-body" style="display:none">
                <div class="modal-image">
                    <div class="carousel slide" id="myCarousel1">
                        <!-- Carousel items -->
                        <div class="carousel-inner">
                            <div class="item active">
                                <img class="tutorialZoom1"
                                    src="/static/trailblazer/images/lung_egfr/min/EGFR-15-min.jpg"
                                    data-zoom-image="/static/trailblazer/images/lung_egfr/EGFR-15.jpg"
                                    alt=""/>
                                <div class="item-inner">

                                <div id="zoomContainer"></div>
                                    <h1>
                                        Sample image 1
                                    </h1>
                                    <h2>
                                        Move your mouse over the image on the left to zoom in and see more detail.
                                    </h2>
                                    <h2>
                                        To identify <b>cancer cells</b>, look for
                                        <b>blotchy cells</b> grouped together in <b>uneven clumps</b>,
                                        <b>rings</b> or
                                        <b>broken chains</b>.
                                    </h2>
                                    <h2>
                                        Can you identify the areas of cancer? Click on 2 to see the answer.
                                    </h2>
                                </div>
                            </div>
                            <div class="item">
                                <img class="tutorialZoom1"
                                    src="/static/trailblazer/images/lung_egfr/annotated-min/49-cancer-area-min.jpg"
                                    data-zoom-image="/static/trailblazer/images/lung_egfr/annotated/49-cancer-outline.jpg"
                                    alt=""/>
                                <div class="item-inner">
                                    <h1>
                                        Sample image 1
                                    </h1>
                                    <h2>
                                        We’ve highlighted the <b class="text-error">lung cancer</b> cells in <b
                                        class="text-error">red</b> in this image. Here they have formed rings with
                                        dead cells in the middle
                                    </h2>
                                    <h2>
                                        <b class="text-success">Healthy lung</b> cells would have formed a thin ring
                                        around an airway (white space)
                                    </h2>
                                </div>
                            </div>
                            <div class="item">
                                <img class="tutorialZoom1"
                                    src="/static/trailblazer/images/lung_egfr/annotated-min/49-non-cancer-area-min.jpg"
                                    data-zoom-image="/static/trailblazer/images/lung_egfr/annotated/49-non-cancer.jpg"
                                    alt=""/>
                                <div class="item-inner">
                                    <h1>
                                        Sample image 1
                                    </h1>
                                    <h2>
                                        The remaining cells are <b>non-cancer</b> and have been highlighted in
                                        <b class="text-success">green</b>.
                                        They include:
                                    </h2>
                                    <ol>
                                        <li><b>Blood cells</b>
                                            <ul>
                                                <li>These are <b>small, dark blue and round</b></li>
                                                <li>They can appear loosely spread out or in very dense clusters</li>
                                            </ul>
                                        </li>
                                        <li><b>Stromal cells</b>
                                            <ul>
                                                <li>These are often <b>light blue, wispy or stretched looking</b></li>
                                                <li>They often look like they are flowing or being stretched in a
                                                    particular direction
                                                </li>
                                            </ul>
                                        </li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-indicators-custom" id="carouselIndicatorsList1"></div>
                        <!-- Carousel nav -->
                        <!--<a class="carousel-control left">&lsaquo;</a>-->
                        <!--<a class="carousel-control right">&rsaquo;</a>-->
                    </div>
                </div>
                <div class="modal-info"></div>
            </div>


            <!-- WITH CAROUSEL-->
            <div id="2" class="modal-body" style="display:none">
                <div class="modal-image">
                    <div class="carousel slide" id="myCarousel2">
                        <!-- Carousel items -->
                        <div class="carousel-inner">
                            <div class="active item">
                                <img class="tutorialZoom2"
                                    src="/static/trailblazer/images/lung_egfr/min/EGFR-11-min.jpg"
                                    data-zoom-image="/static/trailblazer/images/lung_egfr/EGFR-11.jpg"
                                    alt=""/>
                                <div class="item-inner">
                                    <h1>
                                        Sample image 2
                                    </h1>
                                    <h2>
                                        The <b>brown staining</b> detects a chemical that is sometimes present on
                                        <strong class="text-success">non-cancer cells</strong>
                                        and sometimes heavily present on <strong class="text-error">cancer
                                        cells</strong> making them <b>very dark brown around their edges</b>.
                                    </h2>
                                    <h2>
                                        Sometimes <strong class="text-error">cancer cells</strong> do not have this
                                        chemical and so will <b>remain blue</b>.
                                    </h2>
                                    <h3>
                                        Have a look at the image on the left and see if you can identify the areas of
                                        cancer. Then click on 2 to see the answer.
                                    </h3>
                                    <h3>
                                        Move your mouse over the image to zoom in and see more detail.
                                    </h3>
                                </div>
                            </div>
                            <div class="item">
                                <img class="tutorialZoom2"
                                    src="/static/trailblazer/images/lung_egfr/annotated-min/410-cancer-area-min.jpg"
                                    data-zoom-image="/static/trailblazer/images/lung_egfr/annotated/410-cancer-outline.jpg"
                                    alt=""/>
                                <div class="item-inner">
                                    <h1>
                                        Sample image 2
                                    </h1>
                                    <h2>
                                        We’ve highlighted the cancer cells in
                                        <b class="text-error">red</b> for this image.
                                    </h2>
                                    <h2>
                                        All of the cancer cells have dark brown lines around their edges in this image
                                    </h2>
                                    <h3>
                                        Move your mouse over the image to zoom in and see more detail.
                                    </h3>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-indicators-custom" id="carouselIndicatorsList2"></div>
                    </div>
                </div>
                <div class="modal-info"></div>
            </div>

            <!--<div id="6" class="modal-body" style="display:none">-->
            <!--<div class="modal-image">-->
            <!--<img class="tutorialZoom6" src="/static/trailblazer/images/lung_egfr/annotated-min/17-non-cancer-area-min.jpg" data-zoom-image="/static/trailblazer/images/lung_egfr/annotated/17-non-cancer-outline.jpg" alt="" />-->
            <!--</div>-->
            <!--<div class="modal-info">-->
            <!--<h1>-->
            <!--Sample image 3-->
            <!--</h1>-->
            <!--<h2>-->
            <!--Sometimes, the <b>brown stain</b> surrounds <b class="text-success">non-cancer</b> cells; we’ve outlined <b>two examples</b> in green.-->
            <!--</h2>-->
            <!--<h2>-->
            <!--These <b class="text-success">healthy lung</b> cells  are tightly organised in a single layer around an airway (white space).-->
            <!--</h2>-->
            <!--<h3>-->
            <!--There are other types of <strong class="text-success">non-cancer</strong> cells in this image. The two most common types are:-->
            <!--</h3>-->
            <!--<ol>-->
            <!--<li><b>Blood cells</b>-->
            <!--<ul>-->
            <!--<li>These are <b>small, dark blue and round</b></li>-->
            <!--<li>There are plenty at the bottom of this image</li>-->
            <!--</ul>-->
            <!--</li>-->
            <!--<li><b>Stromal cells</b>-->
            <!--<ul>-->
            <!--<li>These are often <b>light blue, wispy or stretched looking</b></li>-->
            <!--<li>They often look like they are flowing or being stretched in a particular direction</li>-->
            <!--</ul>-->
            <!--</li>-->
            <!--</ol>-->
            <!--</div>-->
            <!--</div>-->

            <div id="3" class="modal-body" style="display:none">
                <div class="modal-image">
                    <div class="carousel slide" id="myCarousel6">
                        <!-- Carousel items -->
                        <div class="carousel-inner">
                            <div class="active item">
                                <img class="tutorialZoom3"
                                    src="/static/trailblazer/images/lung_egfr/annotated-min/17-non-cancer-area-min.jpg"
                                    data-zoom-image="/static/trailblazer/images/lung_egfr/annotated/17-non-cancer-outline.jpg"
                                    alt=""/>
                                <div class="item-inner" style="display: block;">
                                    <h1>
                                        Sample image 3
                                    </h1>
                                    <h2>
                                        Sometimes, the <b>brown stain</b> surrounds <b
                                        class="text-success">non-cancer</b> cells; we’ve outlined <b>two
                                        examples</b> in green.
                                    </h2>
                                    <h2>
                                        These <b class="text-success">healthy lung</b> cells are tightly organised in a
                                        single layer around an airway (white space).
                                    </h2>
                                    <h3>
                                        There are other types of <strong class="text-success">non-cancer</strong> cells
                                        in this image. The two most common types are:
                                    </h3>
                                    <ol>
                                        <li><b>Blood cells</b>
                                            <ul>
                                                <li>These are <b>small, dark blue and round</b></li>
                                                <li>There are plenty at the bottom of this image</li>
                                            </ul>
                                        </li>
                                        <li><b>Stromal cells</b>
                                            <ul>
                                                <li>These are often <b>light blue, wispy or stretched looking</b></li>
                                                <li>They often look like they are flowing or being stretched in a
                                                    particular direction
                                                </li>
                                            </ul>
                                        </li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-info"></div>
            </div>

            <!-- WITH CAROUSEL-->
            <div id="4" class="modal-body" style="display:none">
                <div class="modal-image">
                    <div class="carousel slide" id="myCarousel4">
                        <!-- Carousel items -->
                        <div class="carousel-inner">
                            <div class="active item">
                                <img class="tutorialZoom4"
                                    src="/static/trailblazer/images/lung_egfr/min/EGFR-25-min.jpg"
                                    data-zoom-image="/static/trailblazer/images/lung_egfr/EGFR-25.jpg"
                                    alt=""/>
                                <div class="item-inner">
                                    <h1>
                                        Sample image 4
                                    </h1>
                                    <h2>
                                        <strong class="text-error">Cancer cells</strong> can look very different from
                                        image to image.
                                    </h2>
                                    <h2>
                                        Have a look at the image on the left and see if you can identify the areas of
                                        cancer. Then click on 2 to see the answer.
                                    </h2>
                                    <h3>
                                        Move your mouse over the image to zoom in and see more detail.
                                    </h3>
                                </div>
                            </div>
                            <div class="item">
                                <img class="tutorialZoom4"
                                    src="/static/trailblazer/images/lung_egfr/annotated-min/61-cancer-area-min.jpg"
                                    data-zoom-image="/static/trailblazer/images/lung_egfr/annotated/61-cancer-outline.jpg"
                                    alt=""/>
                                <div class="item-inner">
                                    <h1>
                                        Sample image 4
                                    </h1>
                                    <h2>
                                        We’ve highlighted the cancer cells in <b class="text-error">red</b> for this
                                        image.
                                    </h2>
                                    <h2>
                                        This time they are in <b>small clumps</b> with only some light brown staining.
                                        They are <b>darker than stromal cells</b> and more <b>mottled and bigger than
                                        blood cells</b>.
                                    </h2>
                                    <h3>
                                        Move your mouse over the image to zoom in and see more detail.
                                    </h3>
                                </div>
                            </div>
                            <div class="item">
                                <img class="tutorialZoom4"
                                    src="/static/trailblazer/images/lung_egfr/annotated-min/61-non-cancer-area-min.jpg"
                                    data-zoom-image="/static/trailblazer/images/lung_egfr/annotated/61-non-cancer-outline.jpg"
                                    alt=""/>
                                <div class="item-inner">
                                    <h1>
                                        Sample image 4
                                    </h1>
                                    <h2>
                                        The remaining cells are <b class="text-success">non-cancer</b> and have been
                                        highlighted in <b class="text-success">green</b>. They include:
                                    </h2>
                                    <ol>
                                        <li><b>Blood cells</b>
                                            <ul>
                                                <li>These are <b>small, dark blue and round</b></li>
                                                <li>They can appear loosely spread out or in very dense clusters</li>
                                            </ul>
                                        </li>
                                        <li><b>Stromal cells</b>
                                            <ul>
                                                <li>These are often <b>light blue, wispy or stretched looking</b></li>
                                                <li>They often look like they are flowing or being stretched in a
                                                    particular direction
                                                </li>
                                            </ul>
                                        </li>
                                    </ol>
                                </div>
                            </div>

                        </div>
                        <div class="carousel-indicators-custom" id="carouselIndicatorsList4"></div>
                    </div>
                </div>
                <div class="modal-info"></div>
            </div>

            <div id="5" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="/static/trailblazer/images/lung_egfr/tutorial/grid.jpg"
                        alt=""/>
                </div>
                <div class="modal-info">
                    <h1>
                        This is what you'll need to do.
                    </h1>
                    <h2>
                        We have split the images up into a 6x6 grid.
                    </h2>
                    <h2>
                        Some of the grid sections contain cancer cells and some of them do not.
                    </h2>
                    <h2>
                        We’re going to show you what to do.
                    </h2>
                </div>
            </div>

            <div id="6" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="/static/trailblazer/images/lung_egfr/tutorial/hover-over.png   " alt=""/>
                </div>
                <div class="modal-info">
                    <h1>Look closely at the cells in each section</h1>
                    <h2>
                        You can zoom in to the image by moving the mouse over each section to get a closer look.
                        In a moment you’ll have a chance to try this for yourself.
                    </h2>
                    <h2>
                        There are a number of reference images at the bottom of the screen
                        showing examples of what <strong class="text-error">cancer</strong> and <strong
                        class="text-success">non-cancer cells</strong> look like.
                    </h2>
                    <h2>
                        Use the arrows to scroll through these.
                    </h2>
                    <h2>
                        In a moment you’ll have a chance to try this for yourself.
                    </h2>
                </div>
            </div>

            <div id="7" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="/static/trailblazer/images/lung_egfr/tutorial/grid-red.jpg"
                        alt=""/>
                </div>
                <div class="modal-info">
                    <h1>
                        We’d like you to mark in <b class="text-error">red</b> any sections that contain cancer cells
                    </h1>
                    <h2>
                        Examine each section and if you think it contains cancer cells (even if you only see one or two
                        cells)
                        <strong>click once to turn that section <b class="text-error">red</b></strong>.
                    </h2>
                </div>
            </div>

            <div id="8" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="/static/trailblazer/images/lung_egfr/tutorial/grid-red-green.jpg"
                        alt=""/>
                </div>
                <div class="modal-info">
                    <h1>
                        We’d like you to mark in <b class="text-success">green</b> any sections that do not contain
                        <strong class="text-error">cancer cells</strong>
                    </h1>
                    <h2>
                        Examine each section and if you think it <b>only contains <strong class="text-success">non-cancer
                        cells</strong></b>, you can <b>click</b> a second time to turn that section from <strong
                        class="text-error">red</strong> to <strong class="text-success">green</strong>.
                    </h2>
                </div>
            </div>

            <div id="9" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="/static/trailblazer/images/lung_egfr/tutorial/grid-red-green.jpg"
                        alt=""/>
                </div>
                <div class="modal-info">
                    <h1>
                        Empty sections can be left blank
                    </h1>
                    <h2>
                        You can ignore any sections that are empty, normally corner and edge sections.
                    </h2>
                    <h2>
                        You can then click on the Next button to move to the next image
                    </h2>
                </div>
            </div>

            <div id="10" class="modal-body" style="display:none;">
                <div class="modal-image">
                    <img src="/static/trailblazer/images/lung_egfr/tutorial/grid.jpg"
                        alt=""/>
                </div>
                <div class="modal-info">
                    <div id="tutorialSummary">
                        <h1>
                            We’ll now show you a few images that you can practise on.
                        </h1>
                        <h2>
                            We’ll let you know if our expert pathologists agreed with your analysis. There will also be
                            information about each image, to help you understand what you are seeing.
                        </h2>
                        <h2>
                            For the first four images we’ll give you immediate feedback on your answers.
                        </h2>
                    </div>
                    <div id="mechanicTutorialSummary" style="display:none;">
                        <h1>
                            You are now about to <strong>start</strong> analysing cancer images.
                        </h1>
                        <ul>
                            <li>
                                You will be shown 12 images to analyse
                            </li>
                            <li>
                                You can stop and resume later if you want to
                            </li>
                            <li>
                                You can return to the tutorial at any time
                            </li>
                            <li>
                                The reference images at the bottom of the screen scroll to show examples of <strong
                                class="text-error">cancer</strong> and <strong class="text-success">non-cancer
                                cells</strong>
                            </li>
                            <li>
                                You can <b>‘Skip’</b> an image if there is something wrong with it
                            </li>
                            <li>
                                Don't worry if you're not sure, just give your best guess
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn pull-left" id="closeMechanicTutorialBtn" data-dismiss="modal"
                    aria-hidden="true" style="display:none;">Close
                </button>
                <a id="prevBtn" href="#" class="btn">Previous</a>
                <a id="nextBtn" href="#" class="btn btn-success">Next</a>
                <a class="btn btn-primary closeBtn" id="startFeedbackBtn" data-dismiss="modal" aria-hidden="true"
                    style="display:none;"><i class="icon-thumbs-up"></i> Practice</a>
                <button class="btn btn-primary closeBtn pull-right " id="goBackBtn" type="button" data-dismiss="modal"
                    aria-hidden="true" style="display:none;">Back to task
                </button>
            </div>
        </div>
    </div>
</div>

<header class="site-header clearfix">
    <div>
        <div id="loadingTask" class="alert alert-info" style="display:none;">
            <strong>Loading task...</strong>
        </div>
        <div id="success" class="alert alert-success" style="display:none">
            <h2><strong>Thanks!</strong> Your answer has been saved</h2>
        </div>
        <div id="loading" class="alert alert-info" style="display:none">
            <h2> Loading next task...</h2>
        </div>
        <div id="taskcompleted" class="alert alert-info" style="display:none">
            <h2><strong>The task has been completed!</strong> Thanks a lot!</h2>
        </div>
        <div id="finish" class="alert alert-success" style="display:none">
            <h2><strong>Thank you</strong> for completing the analysis part of Trailblazer!</h2>
            <h2>The final step is to provide some feedback on using the system.</h2>
            <div class="alert-actions" id="give-feedback-link">
                <a class="btn small" href="">Give feedback</a>
            </div>
        </div>
        <div id="error" class="alert alert-error" style="display:none">
            <h2><strong>Error!</strong> Something went wrong, please contact the site administrators</h2>
        </div>
        <!-- <div id="errorClick" class="alert alert-info" style="display:none; position: relative;">
      <i class="icon-remove" id="errorClickCross" style="position:absolute; right: 30px; cursor:pointer;"></i>
      <h2>If you are having problems clicking the grid, please refresh the page by clicking
        <b onclick="location.reload();" style="cursor:pointer;"><u>here</u></b></h2>
    </div> -->
    </div>
</header>

<main class="site-content clearfix">
    <!--LEGEND-->
    <div class="legend">
        <div class="legend-item">
            Cancer =
            <div class="square square-red"></div>
        </div>
        <div class="legend-item legend-item__non-cancer">
            Non-cancer =
            <div class="square square-green"></div>
        </div>
        <div class="legend-item feedback-show">
            Correct =
            <i class="icon-ok"></i>
        </div>
        <div class="legend-item feedback-show">
            Incorrect =
            <i class="icon-remove"></i>
        </div>
    </div>
    <!--MECHANIC-->
    <div class="mechanic-content" id="mechanicContent" style="display:none;">
        <div class="row-fluid">
            <div class="span12">
                <h1>Trailblazer - Task <span id="tasksCompleted"></span></h1>
            </div>
        </div>
        <div class="row-fluid clearfix">
            <!-- LEFT HAND SIDE-->
            <div class="span6 right wrapper grid-wrapper task-image-wrapper">
                <div class="loader">
                    <div class="loader-circle1 loader-circle"></div>
                    <div class="loader-circle2 loader-circle"></div>
                    <div class="loader-circle3 loader-circle"></div>
                    <div class="loader-circle4 loader-circle"></div>
                    <div class="loader-circle5 loader-circle"></div>
                    <div class="loader-circle6 loader-circle"></div>
                    <div class="loader-circle7 loader-circle"></div>
                    <div class="loader-circle8 loader-circle"></div>
                    <div class="loader-circle9 loader-circle"></div>
                    <div class="loader-circle10 loader-circle"></div>
                    <div class="loader-circle11 loader-circle"></div>
                    <div class="loader-circle12 loader-circle"></div>
                    <span>Loading task image...</span>
                </div>
                <a class="task-image-wrapper" id="photo-link"></a>
                <div class="canvas" id="mechanicCanvas"></div>
            </div>
            <!-- RIGHT HAND SIDE -->
            <div class="span6 grid-info" id="mechanicZoomWindowLocation">
                <div class="grid-info-content">
                    <div class="grid-selection__container">
                        <h1>Can you see any cancer cells in this image?</h1>
                        <h3>Select your answer and then click Next.</h3>
                        <form class="user-cancer-question">
                            <input type="radio" name="cancerAnswer" value="hasCancer"><span>Yes - this image contains cancer</span>
                            <div class="radio-spacing"></div>
                            <input type="radio" name="cancerAnswer" value="noCancer"><span>No - this image does not contain cancer</span>
                        </form>
                    </div>
                    <div class="proportion-slider__container" style="display: none;">
                        <h2>What proportion of cancer cells are stained.</h2>
                        <div id="proportion-slider" class="proportion-slider"></div>
                        <div class="proportion-slider__valueContainer">
                            <div class="proportion-slider__valueText">Your value:</div>
                            <div class="proportion-slider__value" style="font-weight: bold;"></div>
                        </div>
                    </div>
                    <div class="intensity-slider__container" style="display: none">
                        <h2>How intense is the staining of cancer cells?</h2>
                        <div id="intensity-slider"></div>
                        <div id="intensity-slider-pips">
                            <span class="intensity-slider-pips__weak">Faint</span>
                            <span class="intensity-slider-pips__moderate">Partial</span>
                            <span class="intensity-slider-pips__strong">Fully</span>
                        </div>
                    </div>
                    <!-- <div class="progress progress-striped">
            <div id="progress" rel="tooltip" title="#" class="bar" style="width: 0%;"></div>
          </div> -->
                    <p class="imgId"></p>
                    <!--<span id="proportion-slider-value">0</span>-->
                    <div class="grid-info-buttons">
                        <button class="btn btn-warning pull-left" id="skipSlideBtn">Skip</button>
                        <button class="btn btn-success nextSliderBtn" id="nextSliderBtn"
                            style="margin-left:10px; float: right;">Next
                        </button>
                        <button class="btn btn-answer btn-success nextSlideBtn" id="nextSlideBtn" value="next"
                            style="margin-left:10px; display: none;">Next slide
                        </button>
                        <button class="btn btn-primary pull-right" style="margin-left:10px;" id="showTutorialModalBtn">
                            Tutorial
                        </button>
                        <button class="btn prevSliderBtn" id="prevSliderBtn" style="float: right; display: none;">Back
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- FEEDBACK -->
    <div class="feedback-content" id="feedbackContent">
        <div class="row-fluid">
            <div class="span12">
                <h1>Practice image <span id="feedbackImageNumber">1</span> of 12</h1>
            </div>
        </div>
        <div class="row-fluid clearfix">
            <!-- LEFT HAND IMAGE  -->
            <div class="span6 grid-wrapper">
                <div class="loader">
                    <div class="loader-circle1 loader-circle"></div>
                    <div class="loader-circle2 loader-circle"></div>
                    <div class="loader-circle3 loader-circle"></div>
                    <div class="loader-circle4 loader-circle"></div>
                    <div class="loader-circle5 loader-circle"></div>
                    <div class="loader-circle6 loader-circle"></div>
                    <div class="loader-circle7 loader-circle"></div>
                    <div class="loader-circle8 loader-circle"></div>
                    <div class="loader-circle9 loader-circle"></div>
                    <div class="loader-circle10 loader-circle"></div>
                    <div class="loader-circle11 loader-circle"></div>
                    <div class="loader-circle12 loader-circle"></div>
                    <span>Loading task image...</span>
                </div>
                <a id="feedbackPhotoWrapper"></a>
                <div class="canvas" id="feedbackCanvas"></div>
            </div>
            <!-- RIGHT FEEDBACK INFO -->
            <div class="span6 grid-info" id="feedbackZoomWindowLocation">
                <div class="feedback-intensity-container" style="display: none;">
                    <!-- Insert content here -->
                    <h2>How intense is the staining of cancer cells?</h2>
                    <div id="feedback-intensity-slider"></div>
                    <div id="feedback-intensity-slider-pips">
                        <span class="intensity-slider-pips__weak">Faint</span>
                        <span class="intensity-slider-pips__moderate">Partial</span>
                        <span class="intensity-slider-pips__strong">Fully</span>
                    </div>
                </div>
                <div class="feedback-proportion-container" style="display: none;">
                    <!-- Insert content here -->
                    <div class="proportion-slider__container">
                        <h2>What proportion of cancer cells are stained.</h2>
                        <div id="feedback-proportion-slider"></div>
                        <div class="proportion-slider__valueContainer">
                            <div class="proportion-slider__valueText">Your value:</div>
                            <div class="feedback-proportion-slider__value" style="font-weight: bold;"></div>
                        </div>
                    </div>
                </div>
                <div class="feedback-grid-container">
                    <h3 class="feedback-grid-container__red">Click once to mark cancer cells in
                        <b class="text-error">Red</b>
                    </h3>
                    <h3 class="feedback-grid-container__green">Click again to mark non-cancer cells in <b
                        class="text-success">Green</b></h3>
                    <h3>Empty sections of the image can be left <b>blank</b></h3>
                    <ol>
                        <li>
                            You can change your answer as often as you want. Just <b>click</b> a section of the image to
                            change your answer.
                        </li>
                        <li>
                            Remember to look at the reference images below for help.
                            <b>Click</b> the arrows to scroll and see more.
                        </li>
                    </ol>
                </div>
                <hr>
                <div id="feedbackProgressText"></div>
                <div id="feedbackCancerTrue" style="display: none;">
                    <p style="font-weight: bold;">This image does contain cancer cells.</p>
                </div>
                <div id="feedbackCancerFalse" style="display: none;">
                    <p style="font-weight: bold;">Well done, you are correct. The image contains no cancer cells.</p>
                </div>
                <h3 class="text-whats-in-image"><b>Click 'What's in this image' button</b>, to see what our experts said
                    before practising on another slide</h3>
                <div class="userCheckFeedbackProportion" style="display: none;"></div>
                <div class="userCheckFeedbackIntensity" style="display: none;"></div>
                <div class="progress progress-success progress-striped" style="display:none;">
                    <div class="bar" id="feedbackProgress"></div>
                </div>
                <div class="grid-info-buttons clearfix">
                    <div class="inner-button-container" style="width: 100%; margin-bottom: 10px;">
                        <a class="btn btn-success " id="checkMyWorkBtn" style="display:none;">
                            Check my answer
                        </a>
                        <button class="btn btn-answer" id="feedbackInfoBtn" style="margin-left: 10px;">What's in this
                            image
                        </button>

                        <a class="btn disabled pull-right" id="nextFeedbackStep" style="margin-left: 10px;">
                            Next slide
                        </a>
                        <button class="btn btn-success pull-right disabled" id="nextFeedbackQuestion"
                            style="margin-left: 10px; display: none;">Next
                        </button>
                        <!-- <button class="btn btn-success pull-right" id="previousFeedbackQuestion" style="margin-left: 10px; display: none;">Back</button> -->
                        <a class="btn disabled" id="finishFeedback" style="display:none; margin-left: 10px;">
                            Next
                        </a>
                    </div>
                    <button class="btn btn-warning" id="feedbackNoCancer" style="display: none;">No Cancer</button>
                </div>
            </div>
        </div>
    </div>
    <!-- EXAMPLES -->
    <div class="row-fluid intensityReference">
        <div class="example-list-intensity clearfix">
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/reference/lung-egfr-gt-intensity1-01.jpg" alt=""/>
                <figcaption class="description non-cancer">Faintly Stained</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/reference/lung-egfr-gt-intensity2-05.jpg" alt=""/>
                <figcaption class="description orange-cancer">Partially Stained</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/reference/lung-egfr-gt-intensity3-09.jpg" alt=""/>
                <figcaption class="description cancer">Fully Stained</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/reference/lung-egfr-gt-intensity1-02.jpg" alt=""/>
                <figcaption class="description non-cancer">Faintly Stained</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/reference/lung-egfr-gt-intensity2-06.jpg" alt=""/>
                <figcaption class="description orange-cancer">Partially Stained</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/reference/lung-egfr-gt-intensity3-10.jpg" alt=""/>
                <figcaption class="description cancer">Fully Stained</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/reference/lung-egfr-gt-intensity2-08.jpg" alt=""/>
                <figcaption class="description orange-cancer">Partially Stained</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/reference/lung-egfr-gt-intensity1-03.jpg" alt=""/>
                <figcaption class="description non-cancer">Faintly Stained</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/reference/lung-egfr-gt-intensity3-12.jpg" alt=""/>
                <figcaption class="description cancer">Fully Stained</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/reference/lung-egfr-gt-intensity2-07.jpg" alt=""/>
                <figcaption class="description orange-cancer">Partially Stained</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/reference/lung-egfr-gt-intensity1-04.jpg" alt=""/>
                <figcaption class="description non-cancer">Faintly Stained</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/reference/lung-egfr-gt-intensity3-11.jpg" alt=""/>
                <figcaption class="description cancer">Fully Stained</figcaption>
            </figure>
        </div>
    </div>
    <div class="row-fluid cancerReference">
        <div class="example-list clearfix">
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/cancer-example-1.jpg" alt=""/>
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/cancer-example-2.jpg" alt=""/>
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/cancer-example-3.jpg" alt=""/>
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/cancer-example-4.jpg" alt=""/>
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/cancer-example-5.jpg" alt=""/>
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/cancer-example-6.jpg" alt=""/>
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/cancer-example-7.jpg" alt=""/>
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/cancer-example-8.jpg" alt=""/>
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/cancer-example-9.jpg" alt=""/>
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/cancer-example-10.jpg" alt=""/>
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item last">
                <img src="/static/trailblazer/images/lung_egfr/examples/non-cancer-example-1.jpg" alt=""/>
                <figcaption class="description non-cancer">Non-cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/non-cancer-example-2.jpg" alt=""/>
                <figcaption class="description non-cancer">Non-cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/non-cancer-example-3.jpg" alt=""/>
                <figcaption class="description non-cancer">Non-cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/non-cancer-example-4.jpg" alt=""/>
                <figcaption class="description non-cancer">Non-cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/non-cancer-example-5.jpg" alt=""/>
                <figcaption class="description non-cancer">Non-cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/non-cancer-example-6.jpg" alt=""/>
                <figcaption class="description non-cancer">Non-cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/non-cancer-example-7.jpg" alt=""/>
                <figcaption class="description non-cancer">Non-cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="/static/trailblazer/images/lung_egfr/examples/non-cancer-example-8.jpg" alt=""/>
                <figcaption class="description non-cancer">Non-cancer Cells</figcaption>
            </figure>
        </div>
    </div>
</main>
<script type="text/javascript" async="async">
    var hasSeenGuidenceInfo = false;
    var totalGridPercentage = "";

    var progressBarTargetValue = 0;  // Normally 75, 0 for testing

    var project_short_name = "{{ project.short_name }}";
    if (project_short_name === "")
        project_short_name = "cancerresearchuk";

    var cookie_feedback_name = project_short_name + 'feedback';
    var cookie_tutorial_name = project_short_name + 'tutorial';

    /**
     * This is the pathologist grid square data that we can check the user answers against
     *
     */

    var feedbackData = [{
        "info": {
            "imgNumber": "/static/trailblazer/images/lung_egfr/EGFR-18.jpg",
            "proportion": "100",
            "intensity": "3+",
            "squares": [
                {"column": 0, "answer": null, "row": 0},
                {"column": 1, "answer": null, "row": 0},
                {"column": 2, "answer": null, "row": 0},
                {"column": 3, "answer": true, "row": 0},
                {"column": 4, "answer": null, "row": 0},
                {"column": 5, "answer": null, "row": 0},
                {"column": 0, "answer": null, "row": 1},
                {"column": 1, "answer": true, "row": 1},
                {"column": 2, "answer": true, "row": 1},
                {"column": 3, "answer": true, "row": 1},
                {"column": 4, "answer": true, "row": 1},
                {"column": 5, "answer": null, "row": 1},
                {"column": 0, "answer": false, "row": 2},
                {"column": 1, "answer": true, "row": 2},
                {"column": 2, "answer": true, "row": 2},
                {"column": 3, "answer": true, "row": 2},
                {"column": 4, "answer": true, "row": 2},
                {"column": 5, "answer": true, "row": 2},
                {"column": 0, "answer": false, "row": 3},
                {"column": 1, "answer": true, "row": 3},
                {"column": 2, "answer": true, "row": 3},
                {"column": 3, "answer": true, "row": 3},
                {"column": 4, "answer": true, "row": 3},
                {"column": 5, "answer": true, "row": 3},
                {"column": 0, "answer": false, "row": 4},
                {"column": 1, "answer": true, "row": 4},
                {"column": 2, "answer": true, "row": 4},
                {"column": 3, "answer": true, "row": 4},
                {"column": 4, "answer": true, "row": 4},
                {"column": 5, "answer": true, "row": 4},
                {"column": 0, "answer": null, "row": 5},
                {"column": 1, "answer": false, "row": 5},
                {"column": 2, "answer": true, "row": 5},
                {"column": 3, "answer": true, "row": 5},
                {"column": 4, "answer": true, "row": 5},
                {"column": 5, "answer": null, "row": 5}
            ]
        }
    },
        //  {
        //        "info": {
        //            "imgNumber": "/static/trailblazer/images/lung_egfr/EGFR-19.jpg",
        //            "proportion": "100",
        //            "intensity": "2+",
        //         "squares": [
        //             {
        //            "column": 0,
        //            "answer": null,
        //            "row": 0
        //          }, {
        //            "column": 1,
        //            "answer": null,
        //            "row": 0
        //          }, {
        //            "column": 2,
        //            "answer": null,
        //            "row": 0
        //          }, {
        //            "column": 3,
        //            "answer": null,
        //            "row": 0
        //          }, {
        //            "column": 4,
        //            "answer": null,
        //            "row": 0
        //          }, {
        //            "column": 5,
        //            "answer": null,
        //            "row": 0
        //          },
        //            {
        //              "column": 0,
        //              "answer": false,
        //              "row": 1
        //            }, {
        //              "column": 1,
        //              "answer": true,
        //              "row": 1
        //            }, {
        //              "column": 2,
        //              "answer": true,
        //              "row": 1
        //            }, {
        //              "column": 3,
        //              "answer": true,
        //              "row": 1
        //            }, {
        //              "column": 4,
        //              "answer": true,
        //              "row": 1
        //            }, {
        //              "column": 5,
        //              "answer": null,
        //              "row": 1
        //            },
        //            {
        //              "column": 0,
        //              "answer": false,
        //              "row": 2
        //            }, {
        //              "column": 1,
        //              "answer": true,
        //              "row": 2
        //            }, {
        //              "column": 2,
        //              "answer": true,
        //              "row": 2
        //            }, {
        //              "column": 3,
        //              "answer": true,
        //              "row": 2
        //            }, {
        //              "column": 4,
        //              "answer": true,
        //              "row": 2
        //            }, {
        //              "column": 5,
        //              "answer": true,
        //              "row": 2
        //            },
        //            {
        //              "column": 0,
        //              "answer": false,
        //              "row": 3
        //            }, {
        //              "column": 1,
        //              "answer": true,
        //              "row": 3
        //            }, {
        //              "column": 2,
        //              "answer": true,
        //              "row": 3
        //            }, {
        //              "column": 3,
        //              "answer": true,
        //              "row": 3
        //            }, {
        //              "column": 4,
        //              "answer": true,
        //              "row": 3
        //            }, {
        //              "column": 5,
        //              "answer": true,
        //              "row": 3
        //            },
        //            {
        //              "column": 0,
        //              "answer": false,
        //              "row": 4
        //            }, {
        //              "column": 1,
        //              "answer": true,
        //              "row": 4
        //            }, {
        //              "column": 2,
        //              "answer": true,
        //              "row": 4
        //            }, {
        //              "column": 3,
        //              "answer": true,
        //              "row": 4
        //            }, {
        //              "column": 4,
        //              "answer": true,
        //              "row": 4
        //            }, {
        //              "column": 5,
        //              "answer": null,
        //              "row": 4
        //            },
        //            {
        //              "column": 0,
        //              "answer": null,
        //              "row": 5
        //            }, {
        //              "column": 1,
        //              "answer": false,
        //              "row": 5
        //            }, {
        //              "column": 2,
        //              "answer": true,
        //              "row": 5
        //            }, {
        //              "column": 3,
        //              "answer": true,
        //              "row": 5
        //            }, {
        //              "column": 4,
        //              "answer": null,
        //              "row": 5
        //            }, {
        //              "column": 5,
        //              "answer": null,
        //              "row": 5
        //            }]
        //        }
        //  },
        {
            "info": {
                "imgNumber": "/static/trailblazer/images/lung_egfr/EGFR-24.jpg",
                "proportion": "0",
                "intensity": null,
                "squares": [{
                    "column": 0,
                    "answer": null,
                    "row": 0
                }, {
                    "column": 1,
                    "answer": false,
                    "row": 0
                }, {
                    "column": 2,
                    "answer": true,
                    "row": 0
                }, {
                    "column": 3,
                    "answer": true,
                    "row": 0
                }, {
                    "column": 4,
                    "answer": null,
                    "row": 0
                }, {
                    "column": 5,
                    "answer": null,
                    "row": 0
                },
                    {
                        "column": 0,
                        "answer": false,
                        "row": 1
                    }, {
                        "column": 1,
                        "answer": false,
                        "row": 1
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 1
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 1
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 1
                    }, {
                        "column": 5,
                        "answer": true,
                        "row": 1
                    },
                    {
                        "column": 0,
                        "answer": false,
                        "row": 2
                    }, {
                        "column": 1,
                        "answer": false,
                        "row": 2
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 2
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 2
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 2
                    }, {
                        "column": 5,
                        "answer": true,
                        "row": 2
                    },
                    {
                        "column": 0,
                        "answer": false,
                        "row": 3
                    }, {
                        "column": 1,
                        "answer": true,
                        "row": 3
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 3
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 3
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 3
                    }, {
                        "column": 5,
                        "answer": true,
                        "row": 3
                    },
                    {
                        "column": 0,
                        "answer": false,
                        "row": 4
                    }, {
                        "column": 1,
                        "answer": true,
                        "row": 4
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 4
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 4
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 4
                    }, {
                        "column": 5,
                        "answer": true,
                        "row": 4
                    },
                    {
                        "column": 0,
                        "answer": null,
                        "row": 5
                    }, {
                        "column": 1,
                        "answer": true,
                        "row": 5
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 5
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 5
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 5
                    }, {
                        "column": 5,
                        "answer": null,
                        "row": 5
                    }]
            }
        },
        {
            "info": {
                "imgNumber": "/static/trailblazer/images/lung_egfr/EGFR-22.jpg",
                "proportion": "100",
                "intensity": "3+",
                "squares": [{
                    "column": 0,
                    "answer": null,
                    "row": 0
                }, {
                    "column": 1,
                    "answer": null,
                    "row": 0
                }, {
                    "column": 2,
                    "answer": true,
                    "row": 0
                }, {
                    "column": 3,
                    "answer": true,
                    "row": 0
                }, {
                    "column": 4,
                    "answer": null,
                    "row": 0
                }, {
                    "column": 5,
                    "answer": null,
                    "row": 0
                },
                    {
                        "column": 0,
                        "answer": null,
                        "row": 1
                    }, {
                        "column": 1,
                        "answer": true,
                        "row": 1
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 1
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 1
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 1
                    }, {
                        "column": 5,
                        "answer": true,
                        "row": 1
                    },
                    {
                        "column": 0,
                        "answer": true,
                        "row": 2
                    }, {
                        "column": 1,
                        "answer": true,
                        "row": 2
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 2
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 2
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 2
                    }, {
                        "column": 5,
                        "answer": true,
                        "row": 2
                    },
                    {
                        "column": 0,
                        "answer": true,
                        "row": 3
                    }, {
                        "column": 1,
                        "answer": true,
                        "row": 3
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 3
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 3
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 3
                    }, {
                        "column": 5,
                        "answer": true,
                        "row": 3
                    },
                    {
                        "column": 0,
                        "answer": null,
                        "row": 4
                    }, {
                        "column": 1,
                        "answer": true,
                        "row": 4
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 4
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 4
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 4
                    }, {
                        "column": 5,
                        "answer": true,
                        "row": 4
                    },
                    {
                        "column": 0,
                        "answer": null,
                        "row": 5
                    }, {
                        "column": 1,
                        "answer": false,
                        "row": 5
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 5
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 5
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 5
                    }, {
                        "column": 5,
                        "answer": null,
                        "row": 5
                    }]
            }
        },
        {
            "info": {
                "imgNumber": "/static/trailblazer/images/lung_egfr/EGFR-03.jpg",
                "proportion": "0",
                "intensity": null,
                "squares": [{
                    "column": 0,
                    "answer": null,
                    "row": 0
                }, {
                    "column": 1,
                    "answer": null,
                    "row": 0
                }, {
                    "column": 2,
                    "answer": false,
                    "row": 0
                }, {
                    "column": 3,
                    "answer": false,
                    "row": 0
                }, {
                    "column": 4,
                    "answer": null,
                    "row": 0
                }, {
                    "column": 5,
                    "answer": null,
                    "row": 0
                },
                    {
                        "column": 0,
                        "answer": null,
                        "row": 1
                    }, {
                        "column": 1,
                        "answer": false,
                        "row": 1
                    }, {
                        "column": 2,
                        "answer": false,
                        "row": 1
                    }, {
                        "column": 3,
                        "answer": false,
                        "row": 1
                    }, {
                        "column": 4,
                        "answer": false,
                        "row": 1
                    }, {
                        "column": 5,
                        "answer": null,
                        "row": 1
                    },
                    {
                        "column": 0,
                        "answer": false,
                        "row": 2
                    }, {
                        "column": 1,
                        "answer": false,
                        "row": 2
                    }, {
                        "column": 2,
                        "answer": false,
                        "row": 2
                    }, {
                        "column": 3,
                        "answer": false,
                        "row": 2
                    }, {
                        "column": 4,
                        "answer": false,
                        "row": 2
                    }, {
                        "column": 5,
                        "answer": false,
                        "row": 2
                    },
                    {
                        "column": 0,
                        "answer": false,
                        "row": 3
                    }, {
                        "column": 1,
                        "answer": false,
                        "row": 3
                    }, {
                        "column": 2,
                        "answer": false,
                        "row": 3
                    }, {
                        "column": 3,
                        "answer": false,
                        "row": 3
                    }, {
                        "column": 4,
                        "answer": false,
                        "row": 3
                    }, {
                        "column": 5,
                        "answer": false,
                        "row": 3
                    },
                    {
                        "column": 0,
                        "answer": null,
                        "row": 4
                    }, {
                        "column": 1,
                        "answer": false,
                        "row": 4
                    }, {
                        "column": 2,
                        "answer": false,
                        "row": 4
                    }, {
                        "column": 3,
                        "answer": false,
                        "row": 4
                    }, {
                        "column": 4,
                        "answer": false,
                        "row": 4
                    }, {
                        "column": 5,
                        "answer": null,
                        "row": 4
                    },
                    {
                        "column": 0,
                        "answer": null,
                        "row": 5
                    }, {
                        "column": 1,
                        "answer": null,
                        "row": 5
                    }, {
                        "column": 2,
                        "answer": false,
                        "row": 5
                    }, {
                        "column": 3,
                        "answer": false,
                        "row": 5
                    }, {
                        "column": 4,
                        "answer": null,
                        "row": 5
                    }, {
                        "column": 5,
                        "answer": null,
                        "row": 5
                    }]
            }
        },
        {
            "info": {
                "imgNumber": "/static/trailblazer/images/lung_egfr/EGFR-11.jpg",
                "proportion": "100",
                "intensity": "3+",
                "squares": [
                    {"column": 0, "answer": null, "row": 0},
                    {"column": 1, "answer": null, "row": 0},
                    {"column": 2, "answer": true, "row": 0},
                    {"column": 3, "answer": true, "row": 0},
                    {"column": 4, "answer": true, "row": 0},
                    {"column": 5, "answer": null, "row": 0},
                    {"column": 0, "answer": null, "row": 1},
                    {"column": 1, "answer": true, "row": 1},
                    {"column": 2, "answer": true, "row": 1},
                    {"column": 3, "answer": true, "row": 1},
                    {"column": 4, "answer": true, "row": 1},
                    {"column": 5, "answer": true, "row": 1},
                    {"column": 0, "answer": true, "row": 2},
                    {"column": 1, "answer": true, "row": 2},
                    {"column": 2, "answer": true, "row": 2},
                    {"column": 3, "answer": true, "row": 2},
                    {"column": 4, "answer": true, "row": 2},
                    {"column": 5, "answer": true, "row": 2},
                    {"column": 0, "answer": true, "row": 3},
                    {"column": 1, "answer": true, "row": 3},
                    {"column": 2, "answer": true, "row": 3},
                    {"column": 3, "answer": true, "row": 3},
                    {"column": 4, "answer": true, "row": 3},
                    {"column": 5, "answer": true, "row": 3},
                    {"column": 0, "answer": true, "row": 4},
                    {"column": 1, "answer": true, "row": 4},
                    {"column": 2, "answer": true, "row": 4},
                    {"column": 3, "answer": true, "row": 4},
                    {"column": 4, "answer": true, "row": 4},
                    {"column": 5, "answer": true, "row": 4},
                    {"column": 0, "answer": null, "row": 5},
                    {"column": 1, "answer": true, "row": 5},
                    {"column": 2, "answer": true, "row": 5},
                    {"column": 3, "answer": true, "row": 5},
                    {"column": 4, "answer": true, "row": 5},
                    {"column": 5, "answer": null, "row": 5}
                ]
            }
        },
        {
            "info": {
                "imgNumber": "/static/trailblazer/images/lung_egfr/EGFR-25.jpg",
                "proportion": "35",
                "intensity": "1+",
                "squares": [
                    {"column": 0, "answer": null, "row": 0},
                    {"column": 1, "answer": null, "row": 0},
                    {"column": 2, "answer": null, "row": 0},
                    {"column": 3, "answer": null, "row": 0},
                    {"column": 4, "answer": null, "row": 0},
                    {"column": 5, "answer": null, "row": 0},
                    {"column": 0, "answer": null, "row": 1},
                    {"column": 1, "answer": false, "row": 1},
                    {"column": 2, "answer": true, "row": 1},
                    {"column": 3, "answer": true, "row": 1},
                    {"column": 4, "answer": true, "row": 1},
                    {"column": 5, "answer": null, "row": 1},
                    {"column": 0, "answer": null, "row": 2},
                    {"column": 1, "answer": true, "row": 2},
                    {"column": 2, "answer": true, "row": 2},
                    {"column": 3, "answer": true, "row": 2},
                    {"column": 4, "answer": true, "row": 2},
                    {"column": 5, "answer": false, "row": 2},
                    {"column": 0, "answer": true, "row": 3},
                    {"column": 1, "answer": true, "row": 3},
                    {"column": 2, "answer": true, "row": 3},
                    {"column": 3, "answer": true, "row": 3},
                    {"column": 4, "answer": false, "row": 3},
                    {"column": 5, "answer": false, "row": 3},
                    {"column": 0, "answer": null, "row": 4},
                    {"column": 1, "answer": true, "row": 4},
                    {"column": 2, "answer": true, "row": 4},
                    {"column": 3, "answer": false, "row": 4},
                    {"column": 4, "answer": false, "row": 4},
                    {"column": 5, "answer": false, "row": 4},
                    {"column": 0, "answer": null, "row": 5},
                    {"column": 1, "answer": false, "row": 5},
                    {"column": 2, "answer": false, "row": 5},
                    {"column": 3, "answer": false, "row": 5},
                    {"column": 4, "answer": false, "row": 5},
                    {"column": 5, "answer": null, "row": 5}
                ]
            }
        },
        {
            "info": {
                "imgNumber": "/static/trailblazer/images/lung_egfr/EGFR-26.jpg",
                "proportion": "75",
                "intensity": "2+",
                "squares": [
                    {"column": 0, "answer": null, "row": 0},
                    {"column": 1, "answer": null, "row": 0},
                    {"column": 2, "answer": null, "row": 0},
                    {"column": 3, "answer": null, "row": 0},
                    {"column": 4, "answer": null, "row": 0},
                    {"column": 5, "answer": null, "row": 0},
                    {"column": 0, "answer": null, "row": 1},
                    {"column": 1, "answer": false, "row": 1},
                    {"column": 2, "answer": true, "row": 1},
                    {"column": 3, "answer": true, "row": 1},
                    {"column": 4, "answer": false, "row": 1},
                    {"column": 5, "answer": null, "row": 1},
                    {"column": 0, "answer": null, "row": 2},
                    {"column": 1, "answer": true, "row": 2},
                    {"column": 2, "answer": true, "row": 2},
                    {"column": 3, "answer": true, "row": 2},
                    {"column": 4, "answer": true, "row": 2},
                    {"column": 5, "answer": false, "row": 2},
                    {"column": 0, "answer": null, "row": 3},
                    {"column": 1, "answer": true, "row": 3},
                    {"column": 2, "answer": true, "row": 3},
                    {"column": 3, "answer": false, "row": 3},
                    {"column": 4, "answer": true, "row": 3},
                    {"column": 5, "answer": true, "row": 3},
                    {"column": 0, "answer": null, "row": 4},
                    {"column": 1, "answer": true, "row": 4},
                    {"column": 2, "answer": true, "row": 4},
                    {"column": 3, "answer": false, "row": 4},
                    {"column": 4, "answer": false, "row": 4},
                    {"column": 5, "answer": false, "row": 4},
                    {"column": 0, "answer": null, "row": 5},
                    {"column": 1, "answer": null, "row": 5},
                    {"column": 2, "answer": true, "row": 5},
                    {"column": 3, "answer": true, "row": 5},
                    {"column": 4, "answer": false, "row": 5},
                    {"column": 5, "answer": null, "row": 5}
                ]
            }
        }, {
            "info": {
                "imgNumber": "/static/trailblazer/images/lung_egfr/EGFR-18.jpg",
                "proportion": "100",
                "intensity": "3+",
                "squares": [
                    {"column": 0, "answer": null, "row": 0},
                    {"column": 1, "answer": null, "row": 0},
                    {"column": 2, "answer": null, "row": 0},
                    {"column": 3, "answer": true, "row": 0},
                    {"column": 4, "answer": null, "row": 0},
                    {"column": 5, "answer": null, "row": 0},
                    {"column": 0, "answer": null, "row": 1},
                    {"column": 1, "answer": true, "row": 1},
                    {"column": 2, "answer": true, "row": 1},
                    {"column": 3, "answer": true, "row": 1},
                    {"column": 4, "answer": true, "row": 1},
                    {"column": 5, "answer": null, "row": 1},
                    {"column": 0, "answer": false, "row": 2},
                    {"column": 1, "answer": true, "row": 2},
                    {"column": 2, "answer": true, "row": 2},
                    {"column": 3, "answer": true, "row": 2},
                    {"column": 4, "answer": true, "row": 2},
                    {"column": 5, "answer": true, "row": 2},
                    {"column": 0, "answer": false, "row": 3},
                    {"column": 1, "answer": true, "row": 3},
                    {"column": 2, "answer": true, "row": 3},
                    {"column": 3, "answer": true, "row": 3},
                    {"column": 4, "answer": true, "row": 3},
                    {"column": 5, "answer": true, "row": 3},
                    {"column": 0, "answer": false, "row": 4},
                    {"column": 1, "answer": true, "row": 4},
                    {"column": 2, "answer": true, "row": 4},
                    {"column": 3, "answer": true, "row": 4},
                    {"column": 4, "answer": true, "row": 4},
                    {"column": 5, "answer": true, "row": 4},
                    {"column": 0, "answer": null, "row": 5},
                    {"column": 1, "answer": false, "row": 5},
                    {"column": 2, "answer": true, "row": 5},
                    {"column": 3, "answer": true, "row": 5},
                    {"column": 4, "answer": true, "row": 5},
                    {"column": 5, "answer": null, "row": 5}
                ]
            }
        },
        {
            "info": {
                "imgNumber": "/static/trailblazer/images/lung_egfr/EGFR-24.jpg",
                "proportion": "0",
                "intensity": null,
                "squares": [{
                    "column": 0,
                    "answer": null,
                    "row": 0
                }, {
                    "column": 1,
                    "answer": false,
                    "row": 0
                }, {
                    "column": 2,
                    "answer": true,
                    "row": 0
                }, {
                    "column": 3,
                    "answer": true,
                    "row": 0
                }, {
                    "column": 4,
                    "answer": null,
                    "row": 0
                }, {
                    "column": 5,
                    "answer": null,
                    "row": 0
                },
                    {
                        "column": 0,
                        "answer": false,
                        "row": 1
                    }, {
                        "column": 1,
                        "answer": false,
                        "row": 1
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 1
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 1
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 1
                    }, {
                        "column": 5,
                        "answer": true,
                        "row": 1
                    },
                    {
                        "column": 0,
                        "answer": false,
                        "row": 2
                    }, {
                        "column": 1,
                        "answer": false,
                        "row": 2
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 2
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 2
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 2
                    }, {
                        "column": 5,
                        "answer": true,
                        "row": 2
                    },
                    {
                        "column": 0,
                        "answer": false,
                        "row": 3
                    }, {
                        "column": 1,
                        "answer": true,
                        "row": 3
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 3
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 3
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 3
                    }, {
                        "column": 5,
                        "answer": true,
                        "row": 3
                    },
                    {
                        "column": 0,
                        "answer": false,
                        "row": 4
                    }, {
                        "column": 1,
                        "answer": true,
                        "row": 4
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 4
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 4
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 4
                    }, {
                        "column": 5,
                        "answer": true,
                        "row": 4
                    },
                    {
                        "column": 0,
                        "answer": null,
                        "row": 5
                    }, {
                        "column": 1,
                        "answer": true,
                        "row": 5
                    }, {
                        "column": 2,
                        "answer": true,
                        "row": 5
                    }, {
                        "column": 3,
                        "answer": true,
                        "row": 5
                    }, {
                        "column": 4,
                        "answer": true,
                        "row": 5
                    }, {
                        "column": 5,
                        "answer": null,
                        "row": 5
                    }]
            }
        },
        {
            "info": {
                "imgNumber": "/static/trailblazer/images/lung_egfr/EGFR-15.jpg",
                "proportion": "50",
                "intensity": "1+",
                "squares": [
                    {"column": 0, "answer": null, "row": 0},
                    {"column": 1, "answer": null, "row": 0},
                    {"column": 2, "answer": null, "row": 0},
                    {"column": 3, "answer": true, "row": 0},
                    {"column": 4, "answer": null, "row": 0},
                    {"column": 5, "answer": null, "row": 0},
                    {"column": 0, "answer": null, "row": 1},
                    {"column": 1, "answer": false, "row": 1},
                    {"column": 2, "answer": true, "row": 1},
                    {"column": 3, "answer": true, "row": 1},
                    {"column": 4, "answer": true, "row": 1},
                    {"column": 5, "answer": null, "row": 1},
                    {"column": 0, "answer": false, "row": 2},
                    {"column": 1, "answer": true, "row": 2},
                    {"column": 2, "answer": true, "row": 2},
                    {"column": 3, "answer": true, "row": 2},
                    {"column": 4, "answer": true, "row": 2},
                    {"column": 5, "answer": true, "row": 2},
                    {"column": 0, "answer": false, "row": 3},
                    {"column": 1, "answer": true, "row": 3},
                    {"column": 2, "answer": true, "row": 3},
                    {"column": 3, "answer": true, "row": 3},
                    {"column": 4, "answer": true, "row": 3},
                    {"column": 5, "answer": true, "row": 3},
                    {"column": 0, "answer": null, "row": 4},
                    {"column": 1, "answer": true, "row": 4},
                    {"column": 2, "answer": true, "row": 4},
                    {"column": 3, "answer": true, "row": 4},
                    {"column": 4, "answer": true, "row": 4},
                    {"column": 5, "answer": true, "row": 4},
                    {"column": 0, "answer": null, "row": 5},
                    {"column": 1, "answer": null, "row": 5},
                    {"column": 2, "answer": true, "row": 5},
                    {"column": 3, "answer": true, "row": 5},
                    {"column": 4, "answer": true, "row": 5},
                    {"column": 5, "answer": null, "row": 5}
                ]
            }
        },
        {
            "info": {
                "imgNumber": "/static/trailblazer/images/lung_egfr/EGFR-27.jpg",
                "proportion": "15",
                "intensity": "2+",
                "squares": [
                    {"column": 0, "answer": null, "row": 0},
                    {"column": 1, "answer": false, "row": 0},
                    {"column": 2, "answer": true, "row": 0},
                    {"column": 3, "answer": true, "row": 0},
                    {"column": 4, "answer": true, "row": 0},
                    {"column": 5, "answer": null, "row": 0},
                    {"column": 0, "answer": false, "row": 1},
                    {"column": 1, "answer": true, "row": 1},
                    {"column": 2, "answer": true, "row": 1},
                    {"column": 3, "answer": true, "row": 1},
                    {"column": 4, "answer": true, "row": 1},
                    {"column": 5, "answer": false, "row": 1},
                    {"column": 0, "answer": true, "row": 2},
                    {"column": 1, "answer": true, "row": 2},
                    {"column": 2, "answer": true, "row": 2},
                    {"column": 3, "answer": true, "row": 2},
                    {"column": 4, "answer": true, "row": 2},
                    {"column": 5, "answer": true, "row": 2},
                    {"column": 0, "answer": true, "row": 3},
                    {"column": 1, "answer": true, "row": 3},
                    {"column": 2, "answer": true, "row": 3},
                    {"column": 3, "answer": true, "row": 3},
                    {"column": 4, "answer": true, "row": 3},
                    {"column": 5, "answer": false, "row": 3},
                    {"column": 0, "answer": false, "row": 4},
                    {"column": 1, "answer": true, "row": 4},
                    {"column": 2, "answer": true, "row": 4},
                    {"column": 3, "answer": true, "row": 4},
                    {"column": 4, "answer": true, "row": 4},
                    {"column": 5, "answer": true, "row": 4},
                    {"column": 0, "answer": null, "row": 5},
                    {"column": 1, "answer": true, "row": 5},
                    {"column": 2, "answer": true, "row": 5},
                    {"column": 3, "answer": true, "row": 5},
                    {"column": 4, "answer": true, "row": 5},
                    {"column": 5, "answer": null, "row": 5}
                ]
            }
        },
        {
            "info": {
                "imgNumber": "/static/trailblazer/images/lung_egfr/EGFR-07.jpg",
                "proportion": "0",
                "intensity": null,
                "squares": [
                    {"column": 0, "answer": null, "row": 0},
                    {"column": 1, "answer": null, "row": 0},
                    {"column": 2, "answer": null, "row": 0},
                    {"column": 3, "answer": false, "row": 0},
                    {"column": 4, "answer": null, "row": 0},
                    {"column": 5, "answer": null, "row": 0},
                    {"column": 0, "answer": null, "row": 1},
                    {"column": 1, "answer": false, "row": 1},
                    {"column": 2, "answer": false, "row": 1},
                    {"column": 3, "answer": false, "row": 1},
                    {"column": 4, "answer": false, "row": 1},
                    {"column": 5, "answer": false, "row": 1},
                    {"column": 0, "answer": false, "row": 2},
                    {"column": 1, "answer": false, "row": 2},
                    {"column": 2, "answer": false, "row": 2},
                    {"column": 3, "answer": false, "row": 2},
                    {"column": 4, "answer": false, "row": 2},
                    {"column": 5, "answer": false, "row": 2},
                    {"column": 0, "answer": false, "row": 3},
                    {"column": 1, "answer": false, "row": 3},
                    {"column": 2, "answer": false, "row": 3},
                    {"column": 3, "answer": false, "row": 3},
                    {"column": 4, "answer": false, "row": 3},
                    {"column": 5, "answer": false, "row": 3},
                    {"column": 0, "answer": false, "row": 4},
                    {"column": 1, "answer": false, "row": 4},
                    {"column": 2, "answer": false, "row": 4},
                    {"column": 3, "answer": false, "row": 4},
                    {"column": 4, "answer": false, "row": 4},
                    {"column": 5, "answer": false, "row": 4},
                    {"column": 0, "answer": null, "row": 5},
                    {"column": 1, "answer": false, "row": 5},
                    {"column": 2, "answer": false, "row": 5},
                    {"column": 3, "answer": false, "row": 5},
                    {"column": 4, "answer": false, "row": 5},
                    {"column": 5, "answer": null, "row": 5}
                ]
            }
        }
    ];


    "use strict";
    /**
     * Main mechanic questions  - Grid, proportion & intensity.
     * Initialises custom sliders and attaches event handlers.
     *
     */

    var questions = {
        proportionSlider: document.getElementById('proportion-slider'),
        intensitySlider: document.getElementById('intensity-slider'),
        nextSliderButton: document.getElementById('nextSliderBtn'),
        prevSliderButton: document.getElementById('prevSliderBtn'),
        // Initialise functions
        init: function () {
            this.proportion();
            this.intensity();
            this.attach();
        },
        // Attach event handlers & sliders
        attach: function () {
            var $intensitySlider = $('.intensity-slider__container');
            var $proportionSlider = $('.proportion-slider__container');
            var $gridSelection = $('.grid-selection__container');
            var $nextImageButton = $('.nextSlideBtn');
            var $skipImageButton = $('#skipSlideBtn');

            $(this.nextSliderButton).on('click', function () {

                if ($(this).hasClass('disabled')) return;

                var checkProportionValue = questions.proportionSlider.noUiSlider.get();

                if ($gridSelection.is(':visible')) {
                    $gridSelection.hide();
                    $proportionSlider.show();
                    $(questions.nextSliderButton).hide();
                    $(questions.prevSliderButton).show();
                    $skipImageButton.hide();
                    questions.unFocus('grid-item');
                    if (checkProportionValue == 0) {
                        $nextImageButton.show();
                    } else {
                        $(questions.nextSliderButton).show();
                    }
                } else {
                    if (checkProportionValue > 0.00) {
                        $intensitySlider.show();
                        $('.cancerReference').hide();
                        $('.intensityReference').show();
                        $proportionSlider.hide();
                        $(this).hide();
                        $nextImageButton.show();
                        $(questions.prevSliderButton).show();
                    } else {
                        return;
                    }
                }
            });

            $(this.prevSliderButton).on('click', function () {
                if ($proportionSlider.is(':visible')) {
                    $proportionSlider.hide();
                    $gridSelection.show();
                    $skipImageButton.show();
                    $(this).hide(); // This refers to button clicked.
                    $nextImageButton.hide();
                    questions.reFocus("grid-item");
                    $(questions.nextSliderButton).show();
                } else {
                    $proportionSlider.show();
                    $('.cancerReference').show();
                    $('.intensityReference').hide();
                    $intensitySlider.hide();
                    $nextImageButton.hide();
                    $(questions.nextSliderButton).show();
                }
            });

            this.intensitySlider.noUiSlider.on('update', function (values, handle) {
                if (values[handle] == 0.00) {
                    questions.removeActive();
                    questions.addActive('.intensity-slider-pips__weak', 'word');
                } else if (values[handle] == 50.00) {
                    questions.removeActive();
                    questions.addActive('.intensity-slider-pips__moderate', 'word');
                } else {
                    questions.removeActive();
                    questions.addActive('.intensity-slider-pips__strong', 'word');
                }
            });

            this.proportionSlider.noUiSlider.on('update', function (values, handle) {
                var roundedValue = Math.floor(values[handle]);
                $('.proportion-slider__value').text(roundedValue + "%");
                if (values[handle] == 0.00 && $proportionSlider.is(':visible')) {
                    $(questions.nextSliderButton).hide();
                    $nextImageButton.show();
                } else {
                    $(questions.nextSliderButton).show();
                    $nextImageButton.hide();
                }
            });
        },
        unFocus: function (target) {
            target = "." + target;
            var classesToCheck = ["grid-item-success", "grid-item-error"];
            var checkForSuccess,
                checkForError;

            $(target).each(function () {
                checkForSuccess = $(this).attr('class').indexOf(classesToCheck[0]) > -1;
                checkForError = $(this).attr('class').indexOf(classesToCheck[1]) > -1;

                if (!checkForSuccess) {
                    if (checkForError) {
                        $(this).attr('class', 'grid-item unFocus isGreen');
                    } else {
                        $(this).attr('class', 'grid-item unFocus');
                    }
                }

                if (checkForSuccess) {
                    $(this).attr('class', 'grid-item unRed');
                }
            });
        },
        reFocus: function (target) {
            target = "." + target;
            var classesToCheck = ["unFocus", "unRed", "isGreen"];
            var checkForUnFocus,
                checkForUnRed,
                checkForGreen;

            $(target).each(function () {
                checkForUnFocus = $(this).attr('class').indexOf(classesToCheck[0]) > -1;
                checkForUnRed = $(this).attr('class').indexOf(classesToCheck[1]) > -1;
                checkForGreen = $(this).attr('class').indexOf(classesToCheck[2]) > -1;

                if (checkForUnFocus) {
                    if (checkForGreen) {
                        $(this).attr('class', 'grid-item grid-item-error');
                    } else {
                        $(this).attr('class', 'grid-item');
                    }
                } else if (checkForUnRed) {
                    $(this).attr('class', 'grid-item grid-item-success');
                }
            });
        },
        // Removes class - can be further adapted
        removeActive: function () {
            var activePip = 'sliderPipActive';
            $('.' + activePip).removeClass(activePip);
        },
        // Adds class
        addActive: function (target, type) {
            if (type == "number") {

            } else if (type == "word") {
                $(target).addClass('sliderPipActive');
            }
        },
        // Creates intensity slider
        intensity: function () {
            noUiSlider.create(this.intensitySlider, {
                start: [0],
                snap: true,
                connect: "lower",
                range: {
                    min: 0,
                    '50%': 50,
                    max: 100
                }
            });
        },
        // Creates proportion slider
        proportion: function () {
            noUiSlider.create(this.proportionSlider, {
                start: [0],
                snap: true,
                connect: "lower",
                // Set custom range.
                range: {
                    min: 0,
                    '5%': 5,
                    '10%': 10,
                    '15%': 15,
                    '20%': 20,
                    '25%': 25,
                    '30%': 30,
                    '35%': 35,
                    '40%': 40,
                    '45%': 45,
                    '50%': 50,
                    '55%': 55,
                    '60%': 60,
                    '65%': 65,
                    '70%': 70,
                    '75%': 75,
                    '80%': 80,
                    '85%': 85,
                    '90%': 90,
                    '95%': 95,
                    max: 100
                },
                pips: {
                    mode: 'positions',
                    values: [0, 20, 40, 60, 80, 100],
                    density: 3
                }
            });
        }
    };

    /**
     *
     * Move into init.js file
     */

    $(document).ready(function () {
        questions.init();
    });

    /**
     *
     Grid Constructor function
     */

    function Grid(task) {
        this.canvas;
        this.task = task;
        this.zoomLensClickEvent();
    }

    /*
     For creating a grid overlayed over the image
     */

    var checkTask;

    Grid.prototype.createGrid = function (canvasElement) {


        var rows = 6,
            columns = 6,
            gridHeight = 460 / columns,
            gridWidth = 460 / rows;

        this.canvas = Raphael(canvasElement, 460, 460);


        /*
         creates 36 grid squares in raphael
         */

        var x, y, i = -1;
        for (y = 0; y < rows; y += 1) {
            for (x = 0; x < columns; x += 1) {

                i++;

                var offsetH = y,
                    offsetW = x,
                    moveDown = (y + gridHeight - offsetH) * y,
                    moveRight = (x + gridWidth - offsetW) * x,
                    gridSquare = this.canvas.rect(moveRight, moveDown, gridWidth, gridHeight).attr({
                        "stroke": "#fff"
                    });
                gridSquare.node.setAttribute("class", "grid-item");


                /*
                 Make sure grid squares start from id 0
                 */

                gridSquare.id = i;

                gridSquare.column = x;
                gridSquare.row = y;
                gridSquare.has_cancer = null;

                /*
                 Save all grid squares in array within main task object
                 We can then grab this when saving the info at the end
                 */


                this.task.answer.squares.push(gridSquare);


            }
        }

    };

    /*
     Initalise and listen for the click on on the little zoom lens and then
     use Raphaeljs functions to find the closest square.
     */

    Grid.prototype.zoomLensClickEvent = function () {


        var clicks = 0,
            timer = null,
            _this = this,
            elementToCheck = $('.grid-selection__container');

        $("body").on("click touchstart", ".zoomLens", function (evt) {
            evt.preventDefault();
            clicks++; //count clicks

            var activeSquare = _this.findClosestSquare();
            var activeSquareNode = activeSquare.node;

            if (elementToCheck.is(':visible')) {
                if (activeSquareNode.className.animVal === "grid-item") {
                    activeSquareNode.setAttribute("class", "grid-item grid-item-success");
                    activeSquare.has_cancer = true;
                } else if (activeSquareNode.className.animVal === "grid-item grid-item-success") {
                    activeSquareNode.setAttribute("class", "grid-item grid-item-error");
                    activeSquare.has_cancer = false;
                } else {
                    activeSquareNode.setAttribute("class", "grid-item");
                    activeSquare.has_cancer = null;
                }
            } else {
                return;
            }
        });
    };

    /*
     Loop through the grid items and find the closest matching grid that have the clicked coordinates
     */

    Grid.prototype.findClosestSquare = function () {

        var _this = this,
            activeSquare,
            target = $(".zoomLens"),
            target_pos = {
                x: parseInt(target.css("left")),
                y: parseInt(target.css("top"))
            };

        // Center the zoom cursor to middle of square
        target_pos.x = target_pos.x + 35.2;
        target_pos.y = target_pos.y + 35.2;


        // Find the closet grid item


        $.each(_this.task.answer.squares, function (key, value) {
            if (value.isPointInside(target_pos.x, target_pos.y)) {
                activeSquare = value;
            }
        });

        return activeSquare;
    };

    /*
     Selects all of the grid squares turning them red and changing the defalut
     square answer to "true" is does have cancer
     */

    Grid.prototype.selectAllSquares = function () {
        for (var i = 0; i < this.task.answer.squares.length; i++) {
            var gridSquare = this.task.answer.squares[i],
                gridSquareNode = this.task.answer.squares[i].node;
            gridSquare.has_cancer = true;
            gridSquareNode.setAttribute("class", "grid-item grid-item-success");
        }
    };

    /*
     Deselects all of the grid squares turning them to have no fill color.
     This also changes the cancer value to "null"
     */

    Grid.prototype.deselectAllSquares = function () {
        for (var i = 0; i < this.task.answer.squares.length; i++) {
            var gridSquare = this.task.answer.squares[i],
                gridSquareNode = this.task.answer.squares[i].node;
            gridSquare.has_cancer = null;
            gridSquareNode.setAttribute("class", "grid-item");
        }
    };


    /**
     * FeedbackGrid Constructor function
     *
     */

    function FeedbackGrid() {
        this.canvas;
        this.tickCross = [];
        this.feedbackObj = {
            answer: {
                squares: []
            }
        };
        this.gridSquares = this.feedbackObj.answer.squares;
        this.zoomLensClickEvent();
        this.initFeedbackIntensitySlider();
        this.initFeedbackProportionSlider();
    }

    /*
     For creating a grid overlayed over the image
     */

    FeedbackGrid.prototype.createGrid = function (canvasElement) {
        var rows = 6;
        var columns = 6;
        var gridHeight = 460 / columns;
        var gridWidth = 460 / rows;
        this.canvas = Raphael(canvasElement, 460, 460);

        // Create a 6x6 grid using Raphaeljs elements so we can interact with them
        //
        //
        var x, y, i = -1;
        for (y = 0; y < rows; y += 1) {
            for (x = 0; x < columns; x += 1) {
                i++;
                var offsetH = y;
                var offsetW = x;
                var moveDown = (y + gridHeight - offsetH) * y;
                var moveRight = (x + gridWidth - offsetW) * x;
                var gridSquare = this.canvas.rect(moveRight, moveDown, gridWidth, gridHeight).attr({
                    "stroke": "#fff"
                });

                // Make sure grid squares start from id 0
                //
                gridSquare.id = i;
                gridSquare.column = x;
                gridSquare.row = y;
                gridSquare.has_cancer = null;

                gridSquare.node.setAttribute("class", "grid-item");

                this.gridSquares.push(gridSquare);

            }
        }
    };


    /*
     Initalise and listen for the click on on the little zoom lens and then
     use Raphaeljs functions to find the closest square.
     */

    FeedbackGrid.prototype.zoomLensClickEvent = function () {
        var _this = this;
        if (step === 4 || step === 5 || step === 6) return;

        $("body").on("click", ".zoomLens", function (evt) {
            evt.preventDefault();

            //if(  step == 1 ) _this.hideMyAnalysis();

            var activeSquare = _this.findClosestSquare();
            var activeSquareNode = activeSquare.node;

            // Check the status of the clicked on grid square and
            // add a class to change its color. Also check if the pathologist
            // agreed with the users answer.
            //
            //
            if (activeSquareNode.className.animVal === "grid-item") {
                activeSquareNode.setAttribute("class", "grid-item grid-item-success");
                activeSquare.has_cancer = true;
                _this.checkGridAnswer(true, activeSquare);

            } else if (activeSquareNode.className.animVal === "grid-item grid-item-success") {
                activeSquareNode.setAttribute("class", "grid-item grid-item-error");
                activeSquare.has_cancer = false;
                _this.checkGridAnswer(false, activeSquare);

            } else {
                activeSquareNode.setAttribute("class", "grid-item");
                activeSquare.has_cancer = null;
                _this.checkGridAnswer(null, activeSquare);
            }
        });

    };


    /*
     Loop through the grid items and find the closest matching grid that have the clicked coordinates
     */

    FeedbackGrid.prototype.findClosestSquare = function () {

        var _this = this;
        var activeSquare;

        /**
         * Find the position of the click on the zoomLens and then
         * center the point to the middle of the square
         *
         */

        var target = $(".zoomLens");
        var target_pos = {
            x: parseInt(target.css("left")),
            y: parseInt(target.css("top"))
        };

        target_pos.x = target_pos.x + 35.2;
        target_pos.y = target_pos.y + 35.2;

        /**
         * Find the closet grid square to the point of the click
         * We use a Raphaeljs method isPointInside to return the element
         *
         */

        $.each(_this.gridSquares, function (idx, square) {
            if (square.isPointInside(target_pos.x, target_pos.y)) {
                activeSquare = square;
            }
        });

        return activeSquare;
    };

    FeedbackGrid.prototype.initFeedbackIntensitySlider = function () {
        var target = document.getElementById('feedback-intensity-slider');
        // Check target for existing slider, if so reset existing slider, if not create slider
        if (target.className.length > 0) {
            // Reset sliders here
        } else {
            noUiSlider.create(target, {
                start: [0],
                snap: true,
                connect: "lower",
                range: {
                    min: 0,
                    '50%': 50,
                    max: 100
                }
            });
            target.noUiSlider.on('update', function (values, handle) {
                if (values[handle] == 0.00) {
                    questions.removeActive();
                    questions.addActive('.intensity-slider-pips__weak', 'word');
                } else if (values[handle] == 50.00) {
                    questions.removeActive();
                    questions.addActive('.intensity-slider-pips__moderate', 'word');
                } else {
                    questions.removeActive();
                    questions.addActive('.intensity-slider-pips__strong', 'word');
                }
            });
        }
    };

    FeedbackGrid.prototype.initFeedbackProportionSlider = function () {
        var target = document.getElementById('feedback-proportion-slider');
        // Check target for existing slider, if so reset existing slider, if not create slider
        if (target.className.length > 0) {
            // Reset sliders here
        } else {
            noUiSlider.create(target, {
                start: [0],
                snap: true,
                connect: "lower",
                // Set custom range.
                range: {
                    min: 0,
                    '5%': 5,
                    '10%': 10,
                    '15%': 15,
                    '20%': 20,
                    '25%': 25,
                    '30%': 30,
                    '35%': 35,
                    '40%': 40,
                    '45%': 45,
                    '50%': 50,
                    '55%': 55,
                    '60%': 60,
                    '65%': 65,
                    '70%': 70,
                    '75%': 75,
                    '80%': 80,
                    '85%': 85,
                    '90%': 90,
                    '95%': 95,
                    max: 100
                },
                pips: {
                    mode: 'positions',
                    values: [0, 20, 40, 60, 80, 100],
                    density: 3
                }
            });
            target.noUiSlider.on('update', function (values, handle) {
                var roundedValue = Math.floor(values[handle]);
                $('.feedback-proportion-slider__value').text(roundedValue + "%");
            });
        }
    };

    FeedbackGrid.prototype.checkIntensityAnswer = function () {
        var answer = feedbackData[step].info.intensity;
        var getValue = $('#feedback-intensity-slider')[0].noUiSlider.get();
        var roundValue = Math.floor(getValue);
        var fully = 100, partially = 50, faintly = 0;
        var answerCorrect;

        if (roundValue === fully) {
            roundValue = "3+";
        } else if (roundValue === partially) {
            roundValue = "2+";
        } else if (roundValue === faintly) {
            roundValue = "1+";
        }

        if (roundValue === answer) {
            answerCorrect = true;
        } else {
            answerCorrect = false;
        }

        if (step === 4 || step === 5 || step === 6) {
            return answer;
        } else {
            return answer;
        }
    };

    FeedbackGrid.prototype.checkProportionAnswer = function (which) {
        var parseAnswer = parseInt(feedbackData[step].info.proportion);
        var answer = parseAnswer;
        var getValue = $('#feedback-proportion-slider')[0].noUiSlider.get();
        var roundValue = Math.floor(getValue);
        var howClose;

        if (roundValue === answer) {
            howClose = "Exact";
        } else if (roundValue <= answer + 10 && roundValue >= answer - 10) {
            howClose = "Good";
        } else if (roundValue <= answer + 20 && roundValue >= answer - 20) {
            howClose = "Not Bad";
        } else {
            howClose = "Bad";
        }
        if (which === "one") {
            return answer;
        } else if (which === "two") {
            return howClose;
        }
    };

    /**
     * After the grid square has been clicked we check that answer against what the
     * pathologist said about the same square.
     *
     */

    FeedbackGrid.prototype.checkGridAnswer = function (action, activeSquare) {
        var _this = this;
        var pathologistAnswer;
        var currentSquare = feedbackData[step].info.squares[activeSquare.id];
        if (typeof(currentSquare) == 'object') {

            // Set target for answer, which we will retreive later
            pathologistAnswer = currentSquare;
        }

        // Check if that square already has a Tick or Cross marking
        this.removeTickOrCross(activeSquare);
        activeSquare.stop();
        activeSquare.animate({
            "fill-opacity": 1
        }, 100);

        // If pathologist agree with the answer given
        if (action === pathologistAnswer.answer) {
            var tick = this.addTick(activeSquare);
            if (step > 3) {
                $("#pathologistFeedback").hide();
                tick.attr("opacity", 0);
            } else {
                this.updateFeedbackProgress();
                this.updateFeedback(pathologistAnswer, true);
            }
        } else {
            var cross = this.addCross(activeSquare);
            if (step > 3) {
                $("#pathologistFeedback").hide();
                cross.attr("opacity", 0);
            } else {
                this.updateFeedbackProgress();
                this.updateFeedback(pathologistAnswer, false);
                activeSquare.animate({
                    "fill-opacity": 1
                }, 2000, function () {
                    activeSquare.attr("fill-opacity", 1)
                    activeSquare.node.setAttribute("class", "grid-item");
                });
            }
        }

        // Check if the grid has been clicked, enable the "Check my work" button
        if (step > 1 && this.tickCross.length > 0) {
            $("#checkMyWorkBtn").removeClass("disabled");
        }
    };

    FeedbackGrid.prototype.removeTickOrCross = function (activeSquare) {
        var parentId = activeSquare.id;
        $.each(this.tickCross, function (idx, marking) {
            if (parentId === marking["data-parent_id"]) {
                marking.remove();
            }
        });
    };

    FeedbackGrid.prototype.addTick = function (activeSquare) {
        var x = Math.floor(activeSquare.attr("x")),
            y = Math.floor(activeSquare.attr("y")),
            parentId = activeSquare.id,
            tickPath = "M " + (x + 15) + "," + (y + 35) + " L " + (x + 30) + "," + (y + 50) + " L " + (x + 60) + "," + (y + 20);

        var tick = this.canvas.path(tickPath).attr({
            "stroke-width": "3px",
            "stroke-opacity": 0
        });

        var anim = Raphael.animation({
            "stroke-opacity": 1
        }, 250);
        tick.animate(anim.delay(1000));
        tick["data-parent_id"] = parentId;
        tick["class"] = "tick";
        this.tickCross.push(tick);
        return tick;
    };

    FeedbackGrid.prototype.addCross = function (activeSquare) {

        var x = Math.floor(activeSquare.attr("x"));
        var y = Math.floor(activeSquare.attr("y"));
        var parentId = activeSquare.id;
        var crossPath = "M " + (x + 20) + "," + (y + 20) + " L " + (x + 55) + "," + (y + 55) + "M " + (x + 20) + "," + (y + 55) + " L " + (x + 55) + "," + (y + 20);

        var cross = this.canvas.path(crossPath).attr({
            "stroke-width": "3px",
            "stroke-opacity": 0
        });

        var anim = Raphael.animation({
            "stroke-opacity": 1
        }, 250);
        cross.animate(anim.delay(1000));

        cross["data-parent_id"] = parentId;
        cross["class"] = "cross";
        this.tickCross.push(cross);

        return cross;
    };

    FeedbackGrid.prototype.updateFeedback = function (pathologistAnswer, state) {
        if (state) {
            $("#pathologistFeedback").removeClass("alert-info").addClass("alert-success");
            $("#pathologistFeedback p").html("<strong>Well done!</strong> Our pathologists agreed with you on that one. Keep going and try and do the whole grid. ");
        } else {
            $("#pathologistFeedback").removeClass("alert-success").addClass("alert-info");
            var htmlString = 'Our pathologists didn’t agree with you on that one.';
            htmlString += ' <strong>';
            if (pathologistAnswer.answer === true) {
                htmlString += 'They said this square contains cancer.';
            }
            if (pathologistAnswer.answer === false) {
                htmlString += 'They said this square did not contain cancer.';
            }
            if (pathologistAnswer.answer === null) {
                htmlString += 'They said this square was blank';
            }
            htmlString += '</strong>';
            //htmlString += ' Try again, and remember to look at the reference images below for guidance';
            $("#pathologistFeedback p").html(htmlString);
        }
        $("#pathologistFeedback").show();
        //$("#pathologistFeedback p").delay(4000).fadeOut(500);
    };

    FeedbackGrid.prototype.removeAllTicks = function () {
        $.each(this.tickCross, function (idx, marking) {
            marking.remove();
        });
    }

    // Displays the pathologist tick's and cross's by changing the opacity of the square
    FeedbackGrid.prototype.showMyAnalysis = function () {
        this.updateFeedbackProgress();
        var feedbackObjAnswer = this.feedbackObj.answer;
        var crosses = [];
        $.each(this.tickCross, function (key, value) {
            value.attr("opacity", 1);
            if (value.class === "cross") {
                findParentSquare(value, feedbackObjAnswer);
            }
        });

        for (var i = 0; i < feedbackData[step].info.squares.length; i++) {
            var profAnswer = feedbackData[step].info.squares[i].answer;
            var userAnswer = feedbackObjAnswer.squares[i].has_cancer;

            if (profAnswer === true) {

            }
        }


        function findParentSquare(cross, feedbackObjAnswer) {
            for (var i = 0; i < feedbackData[step].info.squares.length; i++) {
                var gridSquare = feedbackObjAnswer.squares[i],
                    gridSquareNode = feedbackObjAnswer.squares[i].node,
                    pathologistAnswer = feedbackData[step].info.squares[i].answer;
                if (gridSquare.id === cross["data-parent_id"]) {
                    gridSquare.node.setAttribute("class", "grid-item");
                    gridSquare.animate({
                        "fill-opacity": 0
                    }, 2000);
                }
            }
        }
    };

    FeedbackGrid.prototype.updateFeedbackProgress = function () {
        var $feedbackProgressBar = $("#feedbackProgress"),
            totalSquares = 36,
            correctSquares = 0;


        if (step >= 7) {
            var interactedNonCancerBlanks = this.interactedBlanksNonCancer();
            var cancerSquares = this.checkCancerSquares();
            totalSquares = cancerSquares + interactedNonCancerBlanks;
        } else {
            var blankSquares = this.checkBlankSquares();
            var interactedBlankSquares = this.interactedBlanks();
            totalSquares -= blankSquares;
            totalSquares += interactedBlankSquares;
        }

        $.each(this.tickCross, function (key, value) {
            value.attr("opacity", 1);
            if (value["class"] === "tick") {
                correctSquares++;
            }
        });

        function between(x, min, max) {
            return x >= min && x <= max;
        }

        function percentage(x) {
            return Math.floor((x / totalSquares) * 100);
        }

        var pct = percentage(correctSquares);

        $(".progress").show();

        totalGridPercentage = pct;

        if (pct >= progressBarTargetValue && hasSeenGuidenceInfo === true) {
            $("#nextFeedbackStep, #finishFeedback").removeClass("disabled");
            $("#nextFeedbackStep, #finishFeedback").addClass("btn-primary");

            $(".taskTitle, .taskSubTitle, .taskParagraph").hide();
            $("#" + "feedbackStep" + step + " .taskFeedback").show();

        } else {
            $("#nextFeedbackStep, #finishFeedback").addClass("disabled");
        }

        this.percentageFeedbackText(pct);
        $feedbackProgressBar.width(pct + "%");
    };

    FeedbackGrid.prototype.percentageFeedbackText = function (pct) {
        var $feedbackText = $("#feedbackProgressText");
        var htmlString = '<h3>';
        if (pct >= progressBarTargetValue && pct > 0) {
            htmlString += 'Well done! ';
        }
        htmlString += 'You\'ve marked ';
        htmlString += pct + '%</strong> of the image sections correctly</h2>';
        if (pct < progressBarTargetValue) {
            htmlString += '<h3>Get ' + progressBarTargetValue + '% correct to go onto the next slide.</h3>';
        }
        $feedbackText.html(htmlString);
    };

    FeedbackGrid.prototype.checkBlankSquares = function () {
        var blankSquares = 0;
        $.each(feedbackData[step].info.squares, function (key, value) {
            if (value.answer === null) {
                blankSquares++;
            }
        });
        return blankSquares;
    };

    FeedbackGrid.prototype.checkCancerSquares = function () {
        var cancerSquares = 0;
        $.each(feedbackData[step].info.squares, function (key, value) {
            if (value.answer === true) {
                cancerSquares++;
            }
        });
        return cancerSquares;
    };

    FeedbackGrid.prototype.interactedBlanks = function () {
        var pathologists = feedbackData[step].info.squares;
        var feedbackSquares = this.feedbackObj.answer.squares;
        var _this = this;
        var result = 0;

        feedbackSquares.forEach(function (square, idx) {
            var isBlank = (pathologists[idx].answer === null);

            // Loop through all of the items in the grid and find the ones which have been interacted with
            var isInteracted =
                    _this.tickCross.filter(
                        function (sq) {
                            return sq["data-parent_id"] === square.id;
                        })[0] !== undefined
                ;
            if (isBlank && isInteracted) {
                result++;
            }
        });
        return result;
    };

    FeedbackGrid.prototype.interactedBlanksNonCancer = function () {
        var pathologists = feedbackData[step].info.squares;
        var feedbackSquares = this.feedbackObj.answer.squares;
        var _this = this;
        var result = 0;

        feedbackSquares.forEach(function (square, idx) {
            var isBlank = (pathologists[idx].answer === null);
            var isNonCancer = (pathologists[idx].answer === false);

            // Loop through all of the items in the grid and find the ones which have been interacted with
            var isInteracted =
                    _this.tickCross.filter(
                        function (sq) {
                            return sq["data-parent_id"] === square.id;
                        })[0] !== undefined
                ;
            if (isBlank && isInteracted || isNonCancer && isInteracted) {
                result++;
            }
        });
        return result;
    };

    // Modal
    function Modal() {
        this.step = -1;
    }

    /**
     * Initialises the modal to open. We remove the functionaly to remove modal by clicking
     * the backdrop also we stop the slides from automatically sliding to next.
     */

    Modal.prototype.open = function (modall, goToStep) {

        $('.zoomContainer').hide();

        this.modal = modall;
        this.tutorialStep = $(this.modal + " #" + this.step);

        $(this.modal).modal({
            backdrop: 'static',
            keyboard: false
        });

        this.showStep(goToStep);
    };

    Modal.prototype.getCurrentStep = function () {
        return $(this.modal + " #" + this.step);
    };

    Modal.prototype.showStep = function (action) {
        $(this.modal + " #" + this.step).hide();
        if (typeof action == "number") {
            this.step = action;
        } else {
            if (action == 'next') {
                this.step += 1;
            }
            if (action == 'prev') {
                this.step -= 1;
            }
        }

        var z = new Zoom();

        if (this.step == 14) {
            $('.zoomContainer').remove();
            $('.zoomWindowContainer').remove();
            $(".tutorialZoom14").elevateZoom();
        }

        var $currentStep = this.getCurrentStep(),
            currentModalStep = this.modal + " #" + this.step,
            currentModalCarousel = currentModalStep + " .carousel",
            currentModalInfo = currentModalStep + " .modal-info",
            currentModalCarouselSlides = currentModalStep + " .item";

        // If modal step has a carousel
        if ($(currentModalCarousel).length > 0) {

            $('.zoomContainer').remove();
            $('.zoomWindowContainer').remove();

            var $activeImgItem = $(this.modal + " #" + this.step + " .carousel-inner .item.active img");

            $activeImgItem.elevateZoom({
                zoomWindowPosition: "",
                lensFadeIn: 500,
                lensFadeOut: 500,
                zoomWindowHeight: 460,
                zoomWindowWidth: 460,
                cursor: "pointer"
            });


            // If the carousel has not been opened before
            if (!$(currentModalCarousel).data("carousel")) {
                $(currentModalCarousel).carousel({
                    interval: false
                });

                var $indicatorList = $("#carouselIndicatorsList" + this.step);

                $(currentModalCarouselSlides).each(function (idx) {
                    // Adding buttons
                    idx++;
                    var $item = $(this),
                        $li = '<div class="carousel-selector-' + idx + '" type="button">' + idx + '</div>';
                    $indicatorList.append($li);
                    //Adding item-info to modal-info
                    $(this).children(".item-inner");
                    $(currentModalInfo).append($item.children(".item-inner"));
                });


                $currentStep.find(".modal-info .item-inner").first().addClass("active");
                $currentStep.find(".carousel-indicators-custom div").first().addClass("active");

                // When you click on each selector
                // Load new content

                $('[class^=carousel-selector-]').on('click', this.nextSlideContent($currentStep));
            }
        }


        if (this.step === 0) {
            $("#prevBtn").hide();
        } else {
            $("#prevBtn").show();
        }

        if ($("#mechanicContent").is(':visible')) {
            $("#closeMechanicTutorialBtn").show();
            $("#tutorialSummary").hide();
            $("#mechanicTutorialSummary").show();
        }

        var $lastStep = $('#tutorialModal .modal-body').length - 1;

        if (this.step == $lastStep) {
            $("#nextBtn").hide();

            if ($("#mechanicContent").is(':visible')) {
                $("#startFeedbackBtn").hide();
                $("#goBackBtn").show();
            } else {
                $("#startFeedbackBtn").show();
                $("#goBackBtn").hide();
            }

        } else {
            $("#nextBtn").show();
            $("#startFeedbackBtn").hide();
        }

        $currentStep.show();

    };

    /*
     If a step in the carousel includes a carousel with multiple slides
     find the content that relates to it and show it one by one.
     */

    Modal.prototype.nextSlideContent = function (carousel) {
        var _this = this;
        return function () {
            $('.zoomContainer').remove();
            $('.zoomWindowContainer').remove();

            var $carouselSelector = $(this),
                $carouselSlide = carousel.find(".modal-info .item-inner"),
                $modalId = _this.getCurrentStep().attr("id");

            $carouselSelector.parent().children().removeClass("active");
            $carouselSelector.addClass("active");

            var id_selector = $carouselSelector.attr("class");
            var $carouselSelectorValue = parseInt($(this).text() - 1);
            //var id = parseInt(id_selector.substr(id_selector.length - 8));

            $carouselSlide.removeClass('active');

            var nextSlideInfo = $($carouselSlide[$carouselSelectorValue]);
            nextSlideInfo.addClass('active');


            var $zoomArea = nextSlideInfo.parent();
            var $currentSlideImg = $(".tutorialZoom" + $modalId)[$carouselSelectorValue];

            $($currentSlideImg).elevateZoom({
                zoomWindowPosition: "",
                lensFadeIn: 500,
                lensFadeOut: 500,
                zoomWindowHeight: 300,
                zoomWindowWidth: 300,
                cursor: "pointer"
            });

            $('#myCarousel' + $modalId).carousel($carouselSelectorValue);

        };

    };


    /*
     *
     * Elevate Zoom
     * =======================
     *
     *
     */


    function Zoom() {

    }


    Zoom.prototype.addZoom = function (element) {
        //alert("zoom");
        var cookie = $.cookie(cookie_feedback_name),
            zoomWindowPos;

        if (cookie === "true")
            zoomWindowPos = "feedbackZoomWindowLocation";
        else
            zoomWindowPos = "mechanicZoomWindowLocation";


        var zoomWindowPosHeight = $("#" + zoomWindowPos).innerHeight(),
            zoomWindowPosWidth = $("#" + zoomWindowPos).innerWidth();


        element.elevateZoom({
            zoomWindowPosition: zoomWindowPos,
            lensFadeIn: 500,
            lensFadeOut: 500,
            zoomWindowHeight: 460,
            zoomWindowWidth: 460,
            cursor: "pointer"
        });


    };


    Zoom.prototype.removeZoom = function (element) {
        $.removeData(element, 'elevateZoom');
        $('.zoomContainer').remove();
        $('.zoomWindowContainer').remove();
    };


    /*
     *
     * Helpful functions
     * =======================
     *
     *
     */


    /*
     Loads user progress into Grid info
     */

    function loadUserProgress() {
        pybossa.userProgress('cancerresearchuk').done(function (data) {
            checkTask = data.done;
            var currentTask = data.done + 1;
            $("#tasksCompleted").text(currentTask + " of " + 10);
            var pct = Math.round((data.done * 100) / data.total);
            $("#progress").css("width", pct.toString() + "%");
            $("#total").text(data.total);
            $("#done").text(data.done);
        });
    }


    /*
     Uses device.js and works out what device we are using
     */

    function whatDevice() {
        var desktop = device.desktop(),
            mobile = device.mobile(),
            tablet = device.tablet(),
            portrait = device.portrait(),
            landscape = device.landscape(),
            iphone = device.iphone(),
            android = device.android(),
            androidTablet = device.androidTablet(),
            blackberryTablet = device.blackberryTablet();


        if (desktop) return "Desktop";
        if (mobile && portrait) return "Mobile portrait";
        if (mobile && portrait) return "Mobile landscape";
        if (tablet && portrait) return "Tablet portrait";
        if (tablet && landscape) return "Tablet landscape";
    }


    /*
     Finds out how long the user has spent on the particular task.
     We then return this value back into the task.answer object which we get back in pybossa
     */

    function secondsToString(seconds) {
        var numhours = Math.floor(((seconds % 31536000) % 86400) / 3600);
        var numminutes = Math.floor((((seconds % 31536000) % 86400) % 3600) / 60);
        var numseconds = (((seconds % 31536000) % 86400) % 3600) % 60;
        return numhours + ":" + numminutes + ":" + numseconds.toFixed(2);
    }


    /*
     We use modenizr to find out with browser we are on and what version.
     Then it returns this value back into the task.answer object which we get back in pybossa
     */

    var BrowserDetect = {
        init: function () {
            this.browser = this.searchString(this.dataBrowser) || "Other";
            this.version = this.searchVersion(navigator.userAgent) || this.searchVersion(navigator.appVersion) || "Unknown";
        },
        searchString: function (data) {
            for (var i = 0; i < data.length; i++) {
                var dataString = data[i].string;
                this.versionSearchString = data[i].subString;

                if (dataString.indexOf(data[i].subString) !== -1) {
                    return data[i].identity;
                }
            }
        },
        searchVersion: function (dataString) {
            var index = dataString.indexOf(this.versionSearchString);
            if (index === -1) {
                return;
            }

            var rv = dataString.indexOf("rv:");
            if (this.versionSearchString === "Trident" && rv !== -1) {
                return parseFloat(dataString.substring(rv + 3));
            } else {
                return parseFloat(dataString.substring(index + this.versionSearchString.length + 1));
            }
        },

        dataBrowser: [{
            string: navigator.userAgent,
            subString: "Chrome",
            identity: "Chrome"
        }, {
            string: navigator.userAgent,
            subString: "MSIE",
            identity: "Explorer"
        }, {
            string: navigator.userAgent,
            subString: "Trident",
            identity: "Explorer"
        }, {
            string: navigator.userAgent,
            subString: "Firefox",
            identity: "Firefox"
        }, {
            string: navigator.userAgent,
            subString: "Safari",
            identity: "Safari"
        }, {
            string: navigator.userAgent,
            subString: "Opera",
            identity: "Opera"
        }]

    };

    BrowserDetect.init();

    /*
     For displaying a message on IE

     if (BrowserDetect.browser == 'Explorer') {
     //$(".wrappy").addClass("active");
     }
     */

    /*
     * PyBossa functions
     * =======================
     * taskLoaded is the first pybossa method that is called
     * =======================
     *
     *
     */

    pybossa.taskLoaded(function (task, deferred) {

        if (!$.isEmptyObject(task)) {

            var img = $('<img />');

            img.load(function () {
                $("#loadingTask").hide();
                loadUserProgress();
                deferred.resolve(task);
            });

            img.attr('src', task.info.url_b).css('height', 460);
            img.attr('data-zoom-image', task.info.url_b);
            img.addClass('img-polaroid');
            task.info.image = img;

            task.answer = {
                squares: [],
                timeTaken: "",
                device: "",
                skipSlide: "",
                browser: "",
                img: "",
                intensity: "",
                proportion: "",
                openModalCount: 0
            };


            img.load(function () {
                // continue as soon as the image is loaded
                deferred.resolve(task);
            });
        } else {

            deferred.resolve(task);
        }

    });

    /*
     Object function to increase or decrease target's z-index
     Use values between 0-6
     */

    var zIndexChange = {
        buttons: $('.grid-info-buttons'),
        nav: $('.navbar-fixed-top'),
        reduce: function (disableZoom) {
            this.buttons.css('z-index', 1);
            this.nav.css('z-index', 2);
            $('.zoomContainer').addClass('overwriteZindex');
        },
        increase: function () {
            this.buttons.css('z-index', 5);
            this.nav.css('z-index', 6);
            $('.zoomContainer').removeClass('overwriteZindex');
        },
    }


    /*
     This grabs the task via an API call using pybossa.js. We retreive all of the task infomation
     in an object called task that we pass into the presentTask method. We first check if there is a task
     If there is then we initalize the Grid constructor and other methods.
     */

    pybossa.presentTask(function (task, deferred) {
        if (!$.isEmptyObject(task) && checkTask != 9) {

            var $legend = $('.legend');

            $('.nextSliderBtn').addClass('disabled');

            if ($legend.is(':visible')) {
                $legend.hide();
            }

            if (task.state == 'completed') {
                $("#loading").hide();
            }

            var openModalCount = 0;
            var skipChangeOfMind = false;

            /*
             Take a time stamp of the time the page loads
             */
            var oldTime = new Date();

            /*
             Load the task image into the page
             */

            $('#photo-link').html('').append(task.info.image);
            var skipImageUrl = $(task.info.image).attr('src');
            $('.skipSlideImage').attr('src', skipImageUrl);
            $('#task-id').html(task.id);
            var imgUrl = task.info.url_b;

            var lastSlashIdx = imgUrl.lastIndexOf("/");
            var newStr = imgUrl.substr(lastSlashIdx + 1, 10);
            $(".imgId").html("Image ID: " + "<strong>" + newStr + "</strong>");


            // Initalise main mechanic, zoom and modal

            /**
             * Remove grid overlay for release 2.1.
             * This disables grid functionality.
             *
             */

            // var grid = new Grid(task);
            // grid.createGrid("mechanicCanvas");

            var zoom = new Zoom();
            zoom.addZoom($(".img-polaroid"));

            var modal = new Modal();

            var showTutorialModalBtn = document.getElementById("showTutorialModalBtn");
            showTutorialModalBtn.onclick = function () {
                modal.open("#tutorialModal", 0);
                zIndexChange.reduce();
                $("#tutorialSummary").hide();
                $("#mechanicTutorialSummary").show();
                zoom.removeZoom($(".tutorialZoom"));
                openModalCount++;
            };

            var closeMechanicTutorialBtn = document.getElementById("closeMechanicTutorialBtn");
            closeMechanicTutorialBtn.onclick = function () {
                zoom.removeZoom($(".tutorialZoom"));
                zIndexChange.increase();
                zoom.addZoom($(".img-polaroid"));
            };


            var goBackBtn = document.getElementById("goBackBtn");
            goBackBtn.onclick = function () {
                zoom.removeZoom($(".tutorialZoom"));
                zoom.addZoom($(".img-polaroid"));
                //$(".modal-body").hide();
                zIndexChange.increase();
            };

            var nextBtn = document.getElementById("nextBtn");
            nextBtn.onclick = function () {
                modal.showStep('next');
            };

            var prevBtn = document.getElementById("prevBtn");
            prevBtn.onclick = function () {
                modal.showStep('prev');
            };

            /*
             Show skip modal
             */

            var showSkipModalBtn = document.getElementById("skipSlideBtn");
            showSkipModalBtn.onclick = function () {
                modal.open('#skipSlideModal');
                zIndexChange.reduce();
            }

            // Variables for answer data

            var changeMind = false;
            var reason = null;
            var cancerAnswer = null;

            var changeMindBtn = document.getElementById('changeMind');
            changeMindBtn.onclick = function () {
                changeMind = true;
                zoom.removeZoom($(".tutorialZoom"));
                zoom.addZoom($(".img-polaroid"));
                $('.skipReason').find('input:checked').prop('checked', false);
                zIndexChange.increase();
            }

            $(".skipReason input:radio").off('click').on('click', function () {
                var value = $(this).val();
                if (value == "image-too-difficult") {
                    $('#iWantToSkip-first').hide();
                    $('#iWantToSkip-last').show();
                } else {
                    $('#iWantToSkip-first').show();
                    $('#iWantToSkip-last').hide();
                }
            });

            $('#changeMind').off('click').on('click', function () {
                $('.skipModalFirst').show();
                $('.skipModalLast').hide();
                $(".skipReason input:radio").prop('checked', false);

                $('#iWantToSkip-first').hide();
                $('#iWantToSkip-last').show();
            });

            $('#iWantToSkip-last').off('click').on('click', function () {
                $('.skipModalFirst').hide();
                $('.skipModalLast').show();

                $('#iWantToSkip-first').show();
                $('#iWantToSkip-last').hide();
            });

            $('.iWantToSkip').off('click').on('click', function () {
                $('#skipSlideModal').hide();
                $('.skipModalFirst').show();
                $('.skipModalLast').hide();

                var skipRadioButtons = $('.skipReason');
                var reason = skipRadioButtons.find('input:checked').val();

                var slideSkippedData = {
                    skipped: true,
                    reason: reason,
                    changeOfMind: changeMind
                }

                // Get all value slider values

                var intensityValue = questions.intensitySlider.noUiSlider.get();
                var proportionValue = questions.proportionSlider.noUiSlider.get();

                // Switch intensity value to string

                if (intensityValue == 0) {
                    intensityValue = "1+";
                } else if (intensityValue == 50) {
                    intensityValue = "2+";
                } else if (intensityValue == 100) {
                    intensityValue = "3+";
                }

                if (proportionValue == 0.00) {
                    intensityValue = null;
                }

                // Grab a new timestamp and find out the difference
                // This is how long the user has been on the task for
                // Then pass it into the answer
                var newTime = new Date(),
                    ms = newTime - oldTime,
                    x = ms / 1000,
                    seconds = secondsToString(x);

                // Pass image number into answer
                var imgUrl = task.info.url_b;
                var result = imgUrl.replace("/static/trailblazer/images/lung_egfr/", "");

                // Create the answer object
                var answer = {
                    squares: [],
                    timeTaken: seconds,
                    device: whatDevice(),
                    browser: BrowserDetect.browser + " V." + BrowserDetect.version,
                    imgNumber: result,
                    cancer: cancerAnswer,
                    skipSlide: slideSkippedData,
                    intensity: intensityValue,
                    proportion: proportionValue,
                    openModalCount: openModalCount
                };

                /*
                 * Save the task information and send to PyBossa
                 */

                if (skipRadioButtons) {
                    skipRadioButtons.find('input:checked').prop('checked', false);
                }

                $('#noCancerBtn').show();
                $('#skipSlideBtn').show();

                pybossa.saveTask(task.id, answer).done(function (data) {
                    loadUserProgress();
                    $("#success").fadeIn(500).delay(1500).fadeOut();
                    $("svg, .zoomContainer,.zoomWindowContainer").remove();
                    deferred.resolve();
                });
            });

            /*
             "Next Slide" Button
             */

            $("input[name='cancerAnswer']").on('click', function () {
                var $nextSliderButton = $('.nextSliderBtn');
                var val = $(this).val();
                if ($nextSliderButton.hasClass('disabled')) {
                    $nextSliderButton.removeClass('disabled');
                }
                if (val === "noCancer") {
                    $('.nextSliderBtn').hide();
                    $('.nextSlideBtn').show();
                } else {
                    $('.nextSliderBtn').show();
                    $('.nextSlideBtn').hide();
                }
            });

            $('.btn-answer').off('click').on('click', function () {

                var newTime = new Date(),
                    ms = newTime - oldTime,
                    x = ms / 1000,
                    seconds = secondsToString(x);

                // Get all value slider values
                var intensityValue = questions.intensitySlider.noUiSlider.get();
                var proportionValue = questions.proportionSlider.noUiSlider.get();
                // Get cancer question value
                var cancerValue = $("input[name='cancerAnswer']:checked").val();

                if (cancerValue == 'noCancer') {
                    cancerAnswer = false;
                } else if (cancerValue == 'hasCancer') {
                    cancerAnswer = true;
                }

                // Switch intensity value to string
                if (intensityValue == 0) {
                    intensityValue = "1+";
                } else if (intensityValue == 50) {
                    intensityValue = "2+";
                } else if (intensityValue == 100) {
                    intensityValue = "3+";
                }

                if (proportionValue == 0.00) {
                    intensityValue = null;
                }

                // Pass image number into answer
                var imgUrl = task.info.url_b;
                var result = imgUrl.replace("/static/trailblazer/images/lung_egfr/", "");

                var slideSkippedData = {
                    skipped: false,
                    reason: null,
                    changeOfMind: changeMind
                }

                // Create the answer object
                var answer = {
                    squares: [],
                    timeTaken: seconds,
                    device: whatDevice(),
                    browser: BrowserDetect.browser + " V." + BrowserDetect.version,
                    imgNumber: result,
                    cancer: cancerAnswer,
                    skipSlide: slideSkippedData,
                    intensity: intensityValue,
                    proportion: proportionValue,
                    openModalCount: openModalCount
                };

                // Reset value sliders to set value
                questions.intensitySlider.noUiSlider.set(0);
                questions.proportionSlider.noUiSlider.set(0);

                // Save the task information and send to PyBossa
                pybossa.saveTask(task.id, answer).done(function (data) {
                    loadUserProgress();
                    $("#success").fadeIn(500).delay(1500).fadeOut();
                    $("svg, .zoomContainer,.zoomWindowContainer").remove();
                    deferred.resolve();
                });

                // Resets questions for next slide
                $('.cancerReference').show();
                $('.intensityReference').hide();
                $('.prevSliderBtn').hide();
                $('.grid-selection__container').show();
                $('.intensity-slider__container').hide();
                $('.proportion-slider__container').hide();
                $('.nextSlideBtn').hide();
                $(questions.nextSliderButton).show();
                $('#noCancerBtn').show();
                $('#hasCancerBtn').show();
                $('#skipSlideBtn').show();
                cancerAnswer = null;
                $("input[name='cancerAnswer']:checked").prop('checked', false);
            });

        } else {
            $("#loading").hide();
            $("#progress").css("width", "100%");
            $("#finish").fadeIn(500);
            $(".site-content").fadeTo("slow", 0.5);
            $(".site-content").css("pointer-events", "none;");
        }
    });


    /**
     * Feedback function
     * This has multiple steps that include and init a new grid
     * we use this funciton to keep the progress through the steps
     *
     */

    var step = -1;

    var $proportionContainer = $('.feedback-proportion-container');
    var $intensityContainer = $('.feedback-intensity-container');
    var $gridContainer = $('.feedback-grid-container');
    var $nextFeedbackQuestion = $('#nextFeedbackQuestion');
    var $nextFeedbackStep = $('#nextFeedbackStep');
    var $checkMyWorkBtn = $('#checkMyWorkBtn');
    var $gridFeedbackArea = $('#feedbackProgressText');
    var $userFeedbackAreaProportion = $('.userCheckFeedbackProportion');
    var $userFeedbackAreaIntensity = $('.userCheckFeedbackIntensity');
    var $feedbackCancerTrue = $('#feedbackCancerTrue');
    var $feedbackCancerFalse = $('#feedbackCancerFalse');
    var $feedbackNoCancerBtn = $('#feedbackNoCancer');

    var feedbackNoCancerBtn = document.getElementById('feedbackNoCancer');
    feedbackNoCancerBtn.onclick = function () {
        var hasCancer;
        for (var i = 0; i < feedbackData[step].info.squares.length; i++) {
            var profAnswer = feedbackData[step].info.squares[i].answer;
            if (profAnswer === true) {
                hasCancer = true;
                break; // Exit loop as we are only checking if any square has cancer.
            } else {
                hasCancer = false;
            }
        }
        if (hasCancer === true) {
            // Display true message
            $('#feedbackCancerTrue').show();
        } else {
            // Display false message
            $('#feedbackCancerFalse').show();
        }
        if ($("#finishFeedback").is(':visible')) {
            $("#finishFeedback").removeClass('disabled');
        }
    };

    var feedbackNextQuestionButton = document.getElementById('nextFeedbackQuestion');
    feedbackNextQuestionButton.onclick = function () {
        if ($(this).hasClass('disabled')) return;
        if (step === 4 || step === 5 || step === 6) {
            $userFeedbackAreaProportion.hide();
            $userFeedbackAreaIntensity.show();
            $proportionContainer.hide();
            $nextFeedbackStep.addClass('disabled');
            $intensityContainer.show();
            $(this).hide();
            $nextFeedbackStep.show();
            $('.cancerReference').hide();
            $('.intensityReference').show();
        } else {
            if ($gridContainer.is(':visible')) {
                if (step === 8) {
                    $(this).hide();
                    $nextFeedbackStep.show();
                    $proportionContainer.show();
                    $gridFeedbackArea.hide();
                    $('.progress').hide();
                    $gridContainer.hide();
                    $gridFeedbackArea.hide();
                    questions.unFocus('grid-item');
                    $feedbackNoCancerBtn.hide();
                    $feedbackCancerTrue.hide();
                    $feedbackCancerFalse.hide();
                    if ($('#feedbackCanvas').find('path')) {
                        $('#feedbackCanvas').find('path').remove();
                    }
                } else {
                    $('.progress').hide();
                    questions.unFocus('grid-item');
                    $userFeedbackAreaProportion.show();
                    $gridFeedbackArea.hide();
                    $feedbackCancerTrue.hide();
                    $feedbackCancerFalse.hide();
                    $gridContainer.hide();
                    $proportionContainer.show();
                    $feedbackNoCancerBtn.hide();
                    if ($('#feedbackCanvas').find('path')) {
                        $('#feedbackCanvas').find('path').remove();
                    }
                }
            } else if ($proportionContainer.is(':visible')) {
                $proportionContainer.hide();
                $('.cancerReference').hide();
                $('.intensityReference').show();
                $userFeedbackAreaProportion.hide();
                $userFeedbackAreaIntensity.show();
                $(this).hide();
                $intensityContainer.show();
                $nextFeedbackStep.show();
                $nextFeedbackStep.addClass('disabled');
            }
        }
        // $(feedbackPreviousQuestionButton).show();
        $(this).addClass('disabled');
    };

    // var feedbackPreviousQuestionButton = document.getElementById('previousFeedbackQuestion');
    // feedbackPreviousQuestionButton.onclick = function() {
    //   if (step === 4 || step === 5 || step === 6) {
    //     $proportionContainer.show();
    //     $userFeedbackAreaProportion.show();
    //     $userFeedbackAreaIntensity.hide();
    //     $intensityContainer.hide();
    //     $(this).hide();
    //     $nextFeedbackStep.hide();
    //     $(feedbackNextQuestionButton).show();
    //   } else {
    //     if ($intensityContainer.is(':visible')) {
    //       $proportionContainer.show();
    //       $intensityContainer.hide();
    //       $(feedbackNextQuestionButton).show();
    //       $userFeedbackAreaProportion.show();
    //       $userFeedbackAreaIntensity.hide();
    //       $nextFeedbackStep.hide();
    //     } else if ($proportionContainer.is(':visible')) {
    //       $(this).hide();
    //       $('.progress').show();
    //       $userFeedbackAreaProportion.hide();
    //       $gridFeedbackArea.show();
    //       $proportionContainer.hide();
    //       questions.reFocus('grid-item');
    //       $gridContainer.show();
    //     }
    //   }
    // };

    function showFeedbackStep(action) {
        $("svg").remove();
        $(".feedback-img-polaroid").remove();
        $(".zoomContainer").remove();
        $(".zoomWindowContainer").remove();
        // $(feedbackPreviousQuestionButton).hide();

        if (action == 'next') {
            step += 1;
            $("#nextFeedbackStep, #checkMyWorkBtn #finishFeedback").addClass("disabled");
            $("#nextFeedbackStep, #finishFeedback").removeClass("btn-primary");
        }

        var feedbackGrid = new FeedbackGrid();
        var modal = new Modal();
        var zoom = new Zoom();

        hasSeenGuidenceInfo = false;
        totalGridPercentage = 0;

        $("#feedbackStep" + step).hide();

        var data_obj = feedbackData[step].info;
        var imgUrl = feedbackData[step].info.imgNumber;

        var img = $('<img />');
        img.attr('src', imgUrl);
        img.attr('data-zoom-image', imgUrl);
        img.addClass('feedback-img-polaroid');

        $('#feedbackPhotoWrapper').append(img);

        $(img).load(function () {
            feedbackGrid.createGrid("feedbackCanvas");
            // zoom.addZoom($(".feedback-img-polaroid"));
            $(".feedback-img-polaroid").elevateZoom({
                zoomWindowPosition: "feedbackZoomWindowLocation",
                lensFadeIn: 500,
                lensFadeOut: 500,
                zoomWindowHeight: 460,
                zoomWindowWidth: 460,
                cursor: "pointer"
            });
        });

        // if (step >= 2) {
        //   $("#nextFeedbackStep").addClass("disabled");
        //   $("#checkMyWorkBtn").show().addClass("disabled");
        // }

        // if (step === 2) { // if is step 3
        //   $("#practiseModal .modal-body").hide();
        //   modal.open("#practiseModal", 5);
        //   zIndexChange.reduce();
        // }

        var $continueBtn = $('.feedbackContinue');
        var $targetClass = $('.feedTutOne');
        var $targetClassTwo = $('.feedTutTwo');
        var $feedbackContinueTwo = $('.feedbackContinueTwo');
        var currentTutSlide = 0;

        // Reset feedback area for each question.
        $userFeedbackAreaProportion.children('h3').remove();
        $userFeedbackAreaIntensity.children('h3').remove();
        $('#feedback-intensity-slider')[0].noUiSlider.set(0);
        $('#feedback-proportion-slider')[0].noUiSlider.set(0);

        var feedbackNextButton = document.getElementById('feedbackNextBtn');
        feedbackNextButton.onclick = function () {
            if ($($targetClass[0]).is(':visible')) {
                $($targetClass[0]).hide();
                $($targetClass[1]).show();
                $(feedbackPreviousButton).show();
            } else if ($($targetClass[1]).is(':visible')) {
                $($targetClass[1]).hide();
                $($targetClass[2]).show();
                $(this).hide();
                $continueBtn.show();
            } else {
                return;
            }
        };
        var feedbackPreviousButton = document.getElementById('feedbackPrevBtn');
        feedbackPreviousButton.onclick = function () {
            if ($($targetClass[1]).is(':visible')) {
                $($targetClass[1]).hide();
                $($targetClass[0]).show();
                $(this).hide();
                $(feedbackNextButton).show();
            } else if ($($targetClass[2]).is(':visible')) {
                $($targetClass[2]).hide();
                $($targetClass[1]).show();
                $(feedbackNextButton).show();
                $continueBtn.hide();
            } else {
                return;
            }
        };
        var feedbackNextButtonTwo = document.getElementById('feedbackNextBtnTwo');
        feedbackNextButtonTwo.onclick = function () {
            if (currentTutSlide === 0) {
                $(feedbackPreviousButtonTwo).show();
                $feedbackContinueTwo.show();
                $(this).hide();
                $($targetClassTwo[currentTutSlide]).hide();
                currentTutSlide += 1;
                $($targetClassTwo[currentTutSlide]).show();
            } else {
                return;
            }

            // if ($($targetClassTwo[0]).is(':visible')) {
            //   $($targetClassTwo[0]).hide();
            //   $($targetClassTwo[1]).show();
            //   $(this).hide();
            //   $(feedbackPreviousButton).show();
            //   $continueBtn.show();
            // } else {
            //   return;
            // }
        };
        var feedbackPreviousButtonTwo = document.getElementById('feedbackPrevBtnTwo');
        feedbackPreviousButtonTwo.onclick = function () {
            if (currentTutSlide === 1) {
                $(feedbackNextBtnTwo).show();
                $feedbackContinueTwo.hide();
                $(this).hide();
                $($targetClassTwo[currentTutSlide]).hide();
                currentTutSlide -= 1;
                $($targetClassTwo[currentTutSlide]).show();
            }

            // if ($($targetClassTwo[1]).is(':visible')) {
            //   $(this).hide();
            //   $(feedbackNextButton).show();
            //   $continueBtn.hide();
            // } else {
            //   return;
            // }
        };

        if (step === 4) {
            // Show second round Tutorial
            $("#practiseModal .modal-body").hide();
            modal.open("#feedbackTutorialOne", 0);
            zIndexChange.reduce(true);
        }

        // Default
        $gridContainer.show();
        $intensityContainer.hide();
        $proportionContainer.hide();

        if (step === 4 || step === 5 || step === 6) {
            $gridContainer.hide();

            $('.text-whats-in-image').hide();
            $proportionContainer.show();
            $('.progress').hide();
            $intensityContainer.hide();
            $nextFeedbackQuestion.show();
            $nextFeedbackStep.hide();
            $checkMyWorkBtn.show();
            $('.legend').hide();
            if (!$('#nextFeedbackQuestion').hasClass('disabled')) {
                $('#nextFeedbackQuestion').addClass('disabled');
            }
            if (!$('#nextFeedbackStep').hasClass('disabled')) {
                $('#nextFeedbackStep').addClass('disabled');
            }
        }

        if (step === 7) {
            // Show second round Tutorial
            $("#practiseModal .modal-body").hide();
            modal.open("#feedbackTutorialTwo", 0);
            zIndexChange.reduce();
        }

        if (step === 7 || step === 8 || step === 9 || step === 10) {
            $('.intensityReference').hide();
            $('.cancerReference').show();
            $proportionContainer.hide();
            $('.feedback-grid-container__green').hide();
            $('.legend-item__non-cancer').hide();
            $intensityContainer.hide();
            $nextFeedbackQuestion.show();
            $nextFeedbackStep.hide();
            $gridFeedbackArea.show();
            $feedbackNoCancerBtn.show();
            $('#feedbackInfoBtn').show();
            if (!$('.legend').is(':visible')) {
                $('.legend').show();
            }
            if (!$('#nextFeedbackQuestion').hasClass('disabled')) {
                $('#nextFeedbackQuestion').addClass('disabled');
            }
            if (!$('#nextFeedbackStep').hasClass('disabled')) {
                $('#nextFeedbackStep').addClass('disabled');
            }
        }

        var checkMyWork = document.getElementById("checkMyWorkBtn");
        checkMyWork.onclick = function () {
            if ($(this).hasClass("disabled")) return;

            // Remove class disabled from next button.
            $(nextFeedbackQuestion).removeClass('disabled');

            // Reset feedback area for each question.
            $userFeedbackAreaProportion.children('h3').remove();
            $userFeedbackAreaIntensity.children('h3').remove();

            if ($gridContainer.is(':visible')) {
                if (totalGridPercentage >= progressBarTargetValue) {
                    $("#nextFeedbackStep").removeClass("disabled");
                    $("#nextFeedbackStep").addClass("btn-primary");
                }
            } else if ($proportionContainer.is(':visible')) {
                $("#nextFeedbackStep").removeClass("disabled");
                $("#nextFeedbackStep").addClass("btn-primary");
            } else if ($intensityContainer.is(':visible')) {
                $("#nextFeedbackStep").removeClass("disabled");
                $("#nextFeedbackStep").addClass("btn-primary");
            }
            if (totalGridPercentage >= progressBarTargetValue) {
                $("#finishFeedback").removeClass("disabled");
                $("#nextFeedbackStep").addClass("btn-primary");
            }

            //$(".taskTitle,.taskSubTitle, .taskParagraph ").hide();
            //$("#" + "feedbackStep" + step + " .taskFeedback").show();

            if ($gridContainer.is(':visible')) {
                var $feedbackTrue = $('#feedbackCancerTrue');
                var $feedbackFalse = $('#feedbackCancerFalse');
                // Check if feedback visible.
                if ($feedbackTrue.is(':visible')) {
                    $feedbackTrue.hide();
                } else if ($feedbackFalse.is(':visible')) {
                    $feedbackFalse.hide();
                }
                feedbackGrid.showMyAnalysis();
            } else if ($proportionContainer.is(':visible')) {
                var exact = "Exact", good = "Good", notBad = "Not Bad", bad = "Bad";
                // if (step === 4 || step === 5 || step === 6) {
                //   var userAnswerCheck = feedbackGrid.checkProportionAnswer("one");
                //   var expertsText = "Our experts thought " + userAnswerCheck + "%" + " of the cancer cells are stained";
                //   var expertsTextCont = $('<h3>');
                //   var userAnswerLowest = userAnswerCheck - 15;
                //   var userAnswerHighest = userAnswerCheck + 15;
                //   // Check if breaks 0 - 100, set to either 0 or 100 if so.
                //   if (userAnswerLowest < 0) {
                //     userAnswerLowest = 0;
                //   }
                //   if (userAnswerHighest > 100) {
                //     userAnswerHighest = 100;
                //   }
                //   var userText = "You only need to be within 15% of what our experts thought. So any guess between " + userAnswerLowest + "% and " + userAnswerHighest + "% is correct.";
                //   var userTextCont = $('<h3>');
                //
                //   expertsTextCont.append(expertsText);
                //   userTextCont.append(userText);
                //   $userFeedbackAreaProportion.append(expertsTextCont, userTextCont);
                //   $userFeedbackAreaProportion.show();
                //
                // } else {


                var userAnswerCheck = feedbackGrid.checkProportionAnswer("one");
                var getValue = $('#feedback-proportion-slider')[0].noUiSlider.get();
                var roundValue = Math.floor(getValue);
                var expertsText = "Our experts thought <b>" + userAnswerCheck + "%</b>" + " of the cancer cells are stained";
                var expertsTextCont = $('<h3>');
                var userAnswerLowest = userAnswerCheck - 15;
                var userAnswerHighest = userAnswerCheck + 15;
                var userText;
                // Check if breaks 0 - 100, set to either 0 or 100 if so.
                if (userAnswerLowest < 0) {
                    userAnswerLowest = 0;
                }
                if (userAnswerHighest > 100) {
                    userAnswerHighest = 100;
                }
                if (roundValue === userAnswerCheck) {
                    userText = "Well done, you matched our experts exactly.";
                } else if (roundValue <= userAnswerHighest && roundValue >= userAnswerLowest) {
                    userText = "And your answer <b>" + roundValue + "</b>% was a good match.";
                } else {
                    userText = "<p>You didn’t quite match our experts.</p> <p>Move the mouse over the image to look at it in more detail.</p> <p>Remember, we’re only interested in the cancer cells.</p>";
                }

                var userTextCont = $('<h3>');

                expertsTextCont.append(expertsText);
                userTextCont.append(userText);
                $userFeedbackAreaProportion.append(expertsTextCont, userTextCont);
                $userFeedbackAreaProportion.show();
                //}
            } else if ($intensityContainer.is(':visible')) {
                // if (step === 4 || step === 5 || step === 6) {
                //   var userAnswerCheck = feedbackGrid.checkIntensityAnswer();
                //   var feedbackText;
                //   if (userAnswerCheck === "3+") {
                //     userAnswerCheck = "FULLY";
                //     feedbackText = "Even without zooming in, you can see dark brown lines forming full circles, diamonds or hexagons around the cells. <br> Zoom in and you might see the “chicken wire” effect. <br> You might also see some background brown staining. Ignore this. You are looking for the brown lines of the cell membrane (they will be invisible if they are not stained).";
                //   } else if (userAnswerCheck === "2+"){
                //     userAnswerCheck = "PARTIALLY";
                //     feedbackText = "They thought you could see dark brown lines but zooming in reveals most were not forming complete circuits around the cells. <br> Don’t worry if you didn’t agree. Sometimes it’s just a matter of opinion. <br> You might also see some cloudy, background bstaining. Ignore this. You are looking for the brown lines of the cell membrane.";
                //   } else if (userAnswerCheck === "1+") {
                //     userAnswerCheck = "FAINTLY";
                //     feedbackText = "They thought you have to zoom in to see the brown lines around the cancer cells. <br> Don’t worry if you thought this might be PARTIAL staining. Sometimes it’s just a matter of opinion. <br> You might also see some cloudy, background staining. Ignore this. You are looking for the brown lines of the cell membrane";
                //   }
                //   var expertsText = "Our experts thought MOST of the stained cancer cells had " + userAnswerCheck + " stained “membranes”";
                //   var expertsTextCont = $('<h3>');
                //   var feedbackCont = $('<h3>');
                //   feedbackCont.append(feedbackText);
                //   expertsTextCont.append(expertsText);
                //   $userFeedbackAreaIntensity.append(expertsTextCont, feedbackCont);
                //   $userFeedbackAreaIntensity.show();
                // } else {
                var userAnswerCheck = feedbackGrid.checkIntensityAnswer();
                var feedbackText;
                var getValue = $('#feedback-intensity-slider')[0].noUiSlider.get();
                var roundValue = Math.floor(getValue);
                var fully = 100, partially = 50, faintly = 0;

                if (roundValue === fully) {
                    roundValue = "3+";
                } else if (roundValue === partially) {
                    roundValue = "2+";
                } else if (roundValue === faintly) {
                    roundValue = "1+";
                }
                if (userAnswerCheck === roundValue) {
                    feedbackText = "<p>Well done, you matched our experts exactly.</p>"
                } else {
                    feedbackText = "<p>You didn't match our experts.</p>"
                    if (userAnswerCheck === "3+") {
                        feedbackText += "<p>Our experts thought most of the stained cancer cells had <b>fully</b> stained membranes.</p>";
                    } else if (userAnswerCheck === "2+") {
                        feedbackText += "<p>Our experts thought most of the stained cancer cells had <b>partially</b> stained membranes.</p> <p>They thought you could see dark brown lines but zooming in reveals most did not completely surround the cell.</p>";
                    } else if (userAnswerCheck === "1+") {
                        feedbackText += "<p>Our experts thought most of the stained cancer cells had <b>faintly</b> stained membranes.</p> <p>They thought you have to zoom in to see the brown lines around the cancer cells.</p>";
                    }
                }
                // Convert expert text.
                if (userAnswerCheck === "1+") {
                    userAnswerCheck = "faintly";
                } else if (userAnswerCheck === "2+") {
                    userAnswerCheck = "partially";
                } else if (userAnswerCheck === "3+") {
                    userAnswerCheck = "fully";
                }

                var feedbackCont = $('<h3>');
                feedbackCont.append(feedbackText);
                $userFeedbackAreaIntensity.append(feedbackCont);
                $userFeedbackAreaIntensity.show();
                //}
            }
        };

        var lastFeedbackStep = feedbackData.length;

        if (step === lastFeedbackStep - 1) {
            $("#nextFeedbackStep").hide();
            $("#finishFeedback").show().addClass("disabled");
            $feedbackNoCancerBtn.show();
            $('.intensityReference').hide();
            $('.cancerReference').show();
        }

        $("#feedbackStep" + step).show();
        $("#feedbackImageNumber").text(step + 1);

    }

    /*
     * UpdatePageState
     * =======================
     * We use this check the state of cookies to show the relevate sections
     * the three sections are "tutorial", "feedback" and "mechanic"
     *
     */

    function UpdatePageState() {
        // State of the page to show to the user
        var page_state = "mechanic";

        // Check if the page should be in show feedback state
        var cookie_feedback = $.cookie(cookie_feedback_name);
        if (cookie_feedback !== null) {
            page_state = "feedback";
        }

        // Check if the page should be in tutorial state
        var cookie_tutorial = $.cookie(cookie_tutorial_name);
        if (cookie_tutorial === null || cookie_tutorial != "seen") {
            page_state = "tutorial";
        }

        // Check if the page should be in show feedback state
        if (cookie_feedback == "false") {
            page_state = "mechanic";
        }

        // If the feedback or mechanic is showing
        // Init the example images in slick corousel
        //
        //
        if (page_state == "feedback" || page_state == "mechanic") {
            $('.example-list').show();

            $('.example-list').slick({
                dots: false,
                infinite: false,
                speed: 300,
                slidesToScroll: 5,
                slidesToShow: 5,
            });
            $('.example-list-intensity').slick({
                dots: false,
                infinite: false,
                speed: 300,
                slidesToScroll: 5,
                slidesToShow: 5,
            });
            $('.intensityReference').hide();
        }

        if (page_state == "tutorial") {
            $("body").addClass("tutorial-active");

            var m = new Modal();
            m.open("#tutorialModal", "next");

            $("#feedbackContent").hide();

            var nextBtn = document.getElementById("nextBtn");
            nextBtn.onclick = function () {
                m.showStep('next');
            };

            var prevBtn = document.getElementById("prevBtn");
            prevBtn.onclick = function () {
                m.showStep('prev');
            };

        } else if (page_state == "feedback") {
            showFeedbackStep('next');
            $("#feedbackContent").show();
            $("body").addClass("feedback-active");
            $("body").removeClass("tutorial-active");
        } else {
            $("#feedbackContent").hide();
            $("body").addClass("mechanic-active");
            $("body").removeClass("feedback-active");
            $("#mechanicContent").show();
            pybossa.run("cancerresearchuk");
        }
    }

    $(function () {
        UpdatePageState();

        /*
         CLICK EVENTS FOR:
         END OF TUTORIAL,
         FEEDBACK AND
         MECHANIC
         */

        // End of the tutorial

        var startFeedbackBtn = document.getElementById("startFeedbackBtn");
        startFeedbackBtn.onclick = function () {
            $("#tutorialModal .modal-body").hide();
            $.cookie(cookie_tutorial_name, "seen");
            $.cookie(cookie_feedback_name, true);
            UpdatePageState();
        };

        // End of feedback/practice round
        //
        //

        var showStartMechanicScreenBtn = document.getElementById('startMechanicScreenBtn');
        showStartMechanicScreenBtn.onclick = function () {
            $('#19').hide();
            var m = new Modal();
            $(this).hide();
            m.open("#practiseModal", 20);
            zIndexChange.reduce();
            $("#startMechanicBtn").show();
        }

        var finishFeedback = document.getElementById("finishFeedback");
        finishFeedback.onclick = function () {
            if ($(this).hasClass("disabled")) return;

            $("svg, .feedback-img-polaroid, .zoomContainer, .zoomWindowContainer").remove();
            $("#backToPractiseBtn").hide();


            $('#startMechanicScreenBtn').show();

            $("#practiseModal .modal-body").hide();

            var m = new Modal();
            m.open("#practiseModal", 19);
            zIndexChange.reduce();
        }

        var startMechanicBtn = document.getElementById("startMechanicBtn");
        startMechanicBtn.onclick = function () {
            zIndexChange.increase();
            $.cookie(cookie_feedback_name, false);
            UpdatePageState();


            //  When opening the tutorial in the main mechanic
            //  the slides dont go to next carousel item
            //
            //
            // SORRY THE UGLIEST THING EVER
            //
            //  Couldnt think of a quick fix to do this in the modal
            //  funtcions.
            //
            // $(".carousel-indicators-custom").empty();
            // $(".item-inner").removeClass("active");
            // $(".carousel-inner .item").removeClass("active");
            // $(".carousel-inner .item:first-child").addClass("active");
            // $("#myCarousel4, #myCarousel5, #myCarousel6").removeData("carousel");
            location.reload();
        }

        // Click events for feedback mechanic
        var nextFeedbackBtn = document.getElementById("nextFeedbackStep");
        nextFeedbackBtn.onclick = function () {
            if ($(this).hasClass("disabled")) return;
            $("#feedbackProgress").width("0%");
            $("#feedbackProgressText").text("");
            if (step === 4 || step === 5 || step === 6) {
                $('.intensityReference').hide();
                $('.cancerReference').show();
            }
            if (step != feedbackData.length - 1) {
                showFeedbackStep('next');
            }
        };

        var feedbackInfoBtn = document.getElementById("feedbackInfoBtn");
        feedbackInfoBtn.onclick = function () {
            zIndexChange.reduce();
            $("#practiseModal .modal-body").hide();

            var annotatedImage = "#practiseModal" + " #" + step + " .annotatedImage";
            var modal = new Modal();
            modal.open("#practiseModal", step);
            var zoom = new Zoom();
            zoom.removeZoom($(".feedback-img-polaroid"));

            $('.zoomContainer').remove();
            $('.zoomWindowContainer').remove();

            var practiseGridInfo = "annotatedImageZoomArea" + step;

            $(annotatedImage).elevateZoom({
                zoomWindowPosition: practiseGridInfo,
                lensFadeIn: 500,
                lensFadeOut: 500,
                zoomWindowHeight: 460,
                zoomWindowWidth: 460,
                cursor: "pointer"
            });

            $('.zoomWindow').css('z-index', '2601');

        };

        var backToPractiseBtn = document.getElementById("backToPractiseBtn");
        backToPractiseBtn.onclick = function () {

            zIndexChange.increase();
            if (totalGridPercentage >= progressBarTargetValue) {
                $("#nextFeedbackStep").removeClass("disabled");
                $("#finishFeedback").removeClass("disabled");
                $("#nextFeedbackStep, #finishFeedback").addClass("btn-primary");
            }

            if (step !== 2) {
                hasSeenGuidenceInfo = true;
            } else {
                hasSeenGuidenceInfo = false;
            }

            var zoom = new Zoom();
            zoom.removeZoom($("#practiseModal" + " #" + step + " .annotatedImage"));

            $('.zoomContainer').remove();
            $('.zoomWindowContainer').remove();

            $(".feedback-img-polaroid").elevateZoom({
                zoomWindowPosition: "feedbackZoomWindowLocation",
                lensFadeIn: 500,
                lensFadeOut: 500,
                zoomWindowHeight: 460,
                zoomWindowWidth: 460,
                cursor: "pointer"
            });

        };

    });
</script>
